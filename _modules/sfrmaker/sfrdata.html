

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>sfrmaker.sfrdata &mdash; SFRmaker 0.6.2.post2.dev0+g2a0d1bd documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> SFRmaker
          

          
          </a>

          
            
            
              <div class="version">
                0.6.2.post2.dev0+g2a0d1bd
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../philosophy.html"> Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html"> Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html"> Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../inputs.html"> Input Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html"> Using SFRmaker with a configuration file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/SFRmaker_demo.html"> Basic Usage in a scripting context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Streambed_elevation_demo.html"> How the streambed elevation sampling works</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html"> Code reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-history.html"> Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html"> Contributing to SFRmaker</a></li>
</ul>
<p class="caption"><span class="caption-text">Bibliography</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../references.html"> References cited</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SFRmaker</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>sfrmaker.sfrdata</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for sfrmaker.sfrdata</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">packaging</span> <span class="kn">import</span> <span class="n">version</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">rasterstats</span> <span class="kn">import</span> <span class="n">zonal_stats</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">LineString</span>
<span class="kn">from</span> <span class="nn">gisutils</span> <span class="kn">import</span> <span class="n">df2shp</span><span class="p">,</span> <span class="n">get_authority_crs</span>
<span class="kn">from</span> <span class="nn">sfrmaker.routing</span> <span class="kn">import</span> <span class="n">find_path</span><span class="p">,</span> <span class="n">renumber_segments</span>
<span class="kn">from</span> <span class="nn">.checks</span> <span class="kn">import</span> <span class="n">valid_rnos</span><span class="p">,</span> <span class="n">valid_nsegs</span><span class="p">,</span> <span class="n">rno_nseg_routing_consistent</span>
<span class="kn">from</span> <span class="nn">.elevations</span> <span class="kn">import</span> <span class="n">smooth_elevations</span>
<span class="kn">from</span> <span class="nn">.flows</span> <span class="kn">import</span> <span class="n">add_to_perioddata</span><span class="p">,</span> <span class="n">add_to_segment_data</span>
<span class="kn">from</span> <span class="nn">.gis</span> <span class="kn">import</span> <span class="n">export_reach_data</span><span class="p">,</span> <span class="n">project</span>
<span class="kn">from</span> <span class="nn">.observations</span> <span class="kn">import</span> <span class="n">write_gage_package</span><span class="p">,</span> <span class="n">write_mf6_sfr_obsfile</span><span class="p">,</span> <span class="n">add_observations</span>
<span class="kn">from</span> <span class="nn">.units</span> <span class="kn">import</span> <span class="n">convert_length_units</span><span class="p">,</span> <span class="n">itmuni_values</span><span class="p">,</span> <span class="n">lenuni_values</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">get_sfr_package_format</span><span class="p">,</span> <span class="n">get_input_arguments</span><span class="p">,</span> <span class="n">assign_layers</span><span class="p">,</span> <span class="n">update</span>
<span class="kn">import</span> <span class="nn">sfrmaker</span>
<span class="kn">from</span> <span class="nn">sfrmaker.base</span> <span class="kn">import</span> <span class="n">DataPackage</span>
<span class="kn">from</span> <span class="nn">sfrmaker.mf5to6</span> <span class="kn">import</span> <span class="n">segment_data_to_period_data</span>
<span class="kn">from</span> <span class="nn">sfrmaker.reaches</span> <span class="kn">import</span> <span class="n">consolidate_reach_conductances</span>
<span class="kn">from</span> <span class="nn">sfrmaker.rivdata</span> <span class="kn">import</span> <span class="n">RivData</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">flopy</span>
    <span class="n">fm</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">modflow</span>
    <span class="n">mf6</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">mf6</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">flopy</span> <span class="o">=</span> <span class="kc">False</span>


<div class="viewcode-block" id="SFRData"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData">[docs]</a><span class="k">class</span> <span class="nc">SFRData</span><span class="p">(</span><span class="n">DataPackage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for working with a streamflow routing (SFR) dataset,</span>
<span class="sd">    where the stream network is discretized into reaches contained</span>
<span class="sd">    within individual model cells. Reaches may be grouped into segments,</span>
<span class="sd">    with routing between segments specified, and routing between reaches</span>
<span class="sd">    within segments based on consecutive numbering (as in MODFLOW-2005).</span>
<span class="sd">    In this case, unique identifier numbers will be assigned to each reach</span>
<span class="sd">    (in the rno column of the reach_data table), and routing connections</span>
<span class="sd">    between rnos will be computed. Alternatively, reaches and their</span>
<span class="sd">    routing connections can be specified directly, as in MODFLOW-6. In this</span>
<span class="sd">    case, MODFLOW-2005 input will be written with one reach per segment.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    reach_data : DataFrame</span>
<span class="sd">        Table containing information on the SFR reaches.</span>
<span class="sd">    segment_data : DataFrame</span>
<span class="sd">        Table containing information on the segments (optional).</span>
<span class="sd">    grid : sfrmaker.grid class instance</span>
<span class="sd">    model_length_units : str</span>
<span class="sd">        &#39;meters&#39; or &#39;feet&#39;</span>
<span class="sd">    model_time_units : str</span>
<span class="sd">        &#39;s&#39;: seconds</span>
<span class="sd">        &#39;meters&#39;: minutes</span>
<span class="sd">        &#39;h&#39;: hours</span>
<span class="sd">        &#39;d&#39;: days</span>
<span class="sd">        &#39;y&#39;: years</span>
<span class="sd">    enforce_increasing_nsegs : bool</span>
<span class="sd">        If True, segment numbering is checked to ensure</span>
<span class="sd">        that it only increases downstream, and reset if it doesnt.</span>
<span class="sd">    package_name : str</span>
<span class="sd">            Base name for writing sfr output.</span>
<span class="sd">    kwargs : keyword arguments</span>
<span class="sd">        Optional values to assign globally to SFR variables. For example</span>
<span class="sd">        icalc=1 would assign all segments an icalc value of 1. For default</span>
<span class="sd">        values see the sfrdata.defaults dictionary. Default values can be</span>
<span class="sd">        assigned using MODFLOW-2005 or MODFLOW-6 terminology.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># conversions to MODFLOW6 variable names</span>
    <span class="n">mf6names</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rno&#39;</span><span class="p">:</span> <span class="s1">&#39;rno&#39;</span><span class="p">,</span>
                <span class="c1"># &#39;node&#39;: &#39;cellid&#39;,</span>
                <span class="s1">&#39;rchlen&#39;</span><span class="p">:</span> <span class="s1">&#39;rlen&#39;</span><span class="p">,</span>
                <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;rwid&#39;</span><span class="p">,</span>
                <span class="s1">&#39;slope&#39;</span><span class="p">:</span> <span class="s1">&#39;rgrd&#39;</span><span class="p">,</span>
                <span class="s1">&#39;strtop&#39;</span><span class="p">:</span> <span class="s1">&#39;rtp&#39;</span><span class="p">,</span>
                <span class="s1">&#39;strthick&#39;</span><span class="p">:</span> <span class="s1">&#39;rbth&#39;</span><span class="p">,</span>
                <span class="s1">&#39;strhc1&#39;</span><span class="p">:</span> <span class="s1">&#39;rhk&#39;</span><span class="p">,</span>
                <span class="s1">&#39;roughch&#39;</span><span class="p">:</span> <span class="s1">&#39;man&#39;</span><span class="p">,</span>
                <span class="s1">&#39;flow&#39;</span><span class="p">:</span> <span class="s1">&#39;inflow&#39;</span><span class="p">,</span>
                <span class="s1">&#39;pptsw&#39;</span><span class="p">:</span> <span class="s1">&#39;rainfall&#39;</span><span class="p">,</span>
                <span class="s1">&#39;etsw&#39;</span><span class="p">:</span> <span class="s1">&#39;evaporation&#39;</span><span class="p">,</span>
                <span class="s1">&#39;runoff&#39;</span><span class="p">:</span> <span class="s1">&#39;runoff&#39;</span><span class="p">,</span>
                <span class="s1">&#39;depth1&#39;</span><span class="p">:</span> <span class="s1">&#39;depth1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;depth2&#39;</span><span class="p">:</span> <span class="s1">&#39;depth2&#39;</span><span class="p">}</span>

    <span class="n">mf5names</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mf6names</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># order for columns in reach_data</span>
    <span class="n">rdcols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rno&#39;</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;j&#39;</span><span class="p">,</span>
              <span class="s1">&#39;iseg&#39;</span><span class="p">,</span> <span class="s1">&#39;ireach&#39;</span><span class="p">,</span> <span class="s1">&#39;rchlen&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="s1">&#39;slope&#39;</span><span class="p">,</span>
              <span class="s1">&#39;strtop&#39;</span><span class="p">,</span> <span class="s1">&#39;strthick&#39;</span><span class="p">,</span> <span class="s1">&#39;strhc1&#39;</span><span class="p">,</span>
              <span class="s1">&#39;thts&#39;</span><span class="p">,</span> <span class="s1">&#39;thti&#39;</span><span class="p">,</span> <span class="s1">&#39;eps&#39;</span><span class="p">,</span> <span class="s1">&#39;uhc&#39;</span><span class="p">,</span>
              <span class="s1">&#39;outreach&#39;</span><span class="p">,</span> <span class="s1">&#39;outseg&#39;</span><span class="p">,</span> <span class="s1">&#39;asum&#39;</span><span class="p">,</span> <span class="s1">&#39;line_id&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
              <span class="s1">&#39;geometry&#39;</span><span class="p">]</span>

    <span class="c1"># order for columns in segment_data</span>
    <span class="n">sdcols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;per&#39;</span><span class="p">,</span> <span class="s1">&#39;nseg&#39;</span><span class="p">,</span> <span class="s1">&#39;icalc&#39;</span><span class="p">,</span> <span class="s1">&#39;outseg&#39;</span><span class="p">,</span> <span class="s1">&#39;iupseg&#39;</span><span class="p">,</span>
              <span class="s1">&#39;iprior&#39;</span><span class="p">,</span> <span class="s1">&#39;nstrpts&#39;</span><span class="p">,</span>
              <span class="s1">&#39;flow&#39;</span><span class="p">,</span> <span class="s1">&#39;runoff&#39;</span><span class="p">,</span> <span class="s1">&#39;etsw&#39;</span><span class="p">,</span> <span class="s1">&#39;pptsw&#39;</span><span class="p">,</span>
              <span class="s1">&#39;roughch&#39;</span><span class="p">,</span> <span class="s1">&#39;roughbk&#39;</span><span class="p">,</span> <span class="s1">&#39;cdpth&#39;</span><span class="p">,</span> <span class="s1">&#39;fdpth&#39;</span><span class="p">,</span>
              <span class="s1">&#39;awdth&#39;</span><span class="p">,</span> <span class="s1">&#39;bwdth&#39;</span><span class="p">,</span>
              <span class="s1">&#39;hcond1&#39;</span><span class="p">,</span> <span class="s1">&#39;thickm1&#39;</span><span class="p">,</span> <span class="s1">&#39;elevup&#39;</span><span class="p">,</span> <span class="s1">&#39;width1&#39;</span><span class="p">,</span> <span class="s1">&#39;depth1&#39;</span><span class="p">,</span>
              <span class="s1">&#39;thts1&#39;</span><span class="p">,</span> <span class="s1">&#39;thti1&#39;</span><span class="p">,</span> <span class="s1">&#39;eps1&#39;</span><span class="p">,</span> <span class="s1">&#39;uhc1&#39;</span><span class="p">,</span>
              <span class="s1">&#39;hcond2&#39;</span><span class="p">,</span> <span class="s1">&#39;thickm2&#39;</span><span class="p">,</span> <span class="s1">&#39;elevdn&#39;</span><span class="p">,</span> <span class="s1">&#39;width2&#39;</span><span class="p">,</span> <span class="s1">&#39;depth2&#39;</span><span class="p">,</span>
              <span class="s1">&#39;thts2&#39;</span><span class="p">,</span> <span class="s1">&#39;thti2&#39;</span><span class="p">,</span> <span class="s1">&#39;eps2&#39;</span><span class="p">,</span> <span class="s1">&#39;uhc2&#39;</span><span class="p">]</span>

    <span class="n">dtypes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rno&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="s1">&#39;j&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span>
              <span class="s1">&#39;iseg&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="s1">&#39;ireach&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="s1">&#39;outreach&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="s1">&#39;line_id&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span>
              <span class="s1">&#39;per&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="s1">&#39;nseg&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="s1">&#39;icalc&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="s1">&#39;outseg&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span>
              <span class="s1">&#39;iupseg&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="s1">&#39;iprior&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="s1">&#39;nstrpts&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span>
              <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">object</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">object</span><span class="p">}</span>

    <span class="c1"># LENUNI = {&quot;u&quot;: 0, &quot;f&quot;: 1, &quot;m&quot;: 2, &quot;c&quot;: 3}</span>
    <span class="n">len_const</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mf">1.486</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mf">100.</span><span class="p">}</span>
    <span class="c1"># {&quot;u&quot;: 0, &quot;s&quot;: 1, &quot;m&quot;: 2, &quot;h&quot;: 3, &quot;d&quot;: 4, &quot;y&quot;: 5}</span>
    <span class="n">time_const</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mf">60.</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mf">3600.</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mf">86400.</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mf">31557600.</span><span class="p">}</span>

    <span class="c1"># default values</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;icalc&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;roughch&#39;</span><span class="p">:</span> <span class="mf">0.037</span><span class="p">,</span>
                <span class="s1">&#39;strthick&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;strhc1&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;istcb2&#39;</span><span class="p">:</span> <span class="mi">223</span><span class="p">,</span>
                <span class="s1">&#39;gage_starting_unit_number&#39;</span><span class="p">:</span> <span class="mi">228</span>
                <span class="p">}</span>
    <span class="n">package_type</span> <span class="o">=</span> <span class="s1">&#39;sfr&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reach_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">segment_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">isfr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">model_length_units</span><span class="o">=</span><span class="s2">&quot;undefined&quot;</span><span class="p">,</span> <span class="n">model_time_units</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span>
                 <span class="n">enforce_increasing_nsegs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">package_name</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">DataPackage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">isfr</span><span class="o">=</span><span class="n">isfr</span><span class="p">,</span>
                         <span class="n">model_length_units</span><span class="o">=</span><span class="n">model_length_units</span><span class="p">,</span>
                         <span class="n">model_time_units</span><span class="o">=</span><span class="n">model_time_units</span><span class="p">,</span>
                         <span class="n">package_name</span><span class="o">=</span><span class="n">package_name</span><span class="p">)</span>

        <span class="c1"># attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_period_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observations</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observations_filename</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># convert any modflow6 kwargs to modflow5</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">SFRData</span><span class="o">.</span><span class="n">mf5names</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">SFRData</span><span class="o">.</span><span class="n">mf6names</span> <span class="k">else</span> <span class="n">k</span><span class="p">:</span>
                  <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="c1"># update default values (used in segment and reach data setup)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_reach_data</span><span class="p">(</span><span class="n">reach_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_segment_data</span><span class="p">(</span><span class="n">segment_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isfropt0_to_1</span><span class="p">()</span>  <span class="c1"># distribute any isfropt=0 segment data to reaches</span>

        <span class="c1"># routing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_segment_routing</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># dictionary of routing connections</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rno_routing</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># dictionary of rno routing connections</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_paths</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># routing sequence from each segment to outlet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reach_paths</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># routing sequence from each reach number to outlet</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_nsegs</span><span class="p">(</span><span class="n">increasing</span><span class="o">=</span><span class="n">enforce_increasing_nsegs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_segments</span><span class="p">()</span>

        <span class="c1"># establish rno routing</span>
        <span class="c1"># set_outreaches checks for valid rnos and resets them if not</span>
        <span class="c1"># resets out reaches either way using segment data</span>
        <span class="c1"># not the ideal logic for MODFLOW 6 case where only</span>
        <span class="c1"># rno and connections are supplied</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_outreaches</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_slopes</span><span class="p">()</span>

        <span class="c1"># have to set the model last, because it also sets up a flopy sfr package instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>  <span class="c1"># attached flopy model instance</span>
        <span class="c1"># self._ModflowSfr2 = None # attached instance of flopy modflow_sfr2 package object</span>

        <span class="c1"># MODFLOW-2005 gages will be assigned sequential unit numbers</span>
        <span class="c1"># starting at gage_starting_unit_number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gage_starting_unit_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;gage_starting_unit_number&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">const</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">const</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_const</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_lenuni</span><span class="p">]</span> <span class="o">*</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">time_const</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_itmuni</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">const</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_itmuni</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;MODFLOW time units code&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">itmuni_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model_time_units</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_lenuni</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;MODFLOW length units code&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">lenuni_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model_length_units</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">structured</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">_structured</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>

    <span class="nd">@model</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>

        <span class="c1"># update the sfr package object as well</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_modflow_sfr2</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">package_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_package_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_package_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_package_name</span> <span class="o">=</span> <span class="s1">&#39;model&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_package_name</span>

    <span class="nd">@package_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">package_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_package_name</span> <span class="o">=</span> <span class="n">package_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">crs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">crs</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">crs_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Length units of the coordinate reference system&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">length_units</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">segment_routing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segment_routing</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing_changed</span><span class="p">():</span>
            <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;per&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">nseg</span><span class="p">,</span> <span class="n">sd</span><span class="o">.</span><span class="n">outseg</span><span class="p">))</span>
            <span class="n">outlets</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>  <span class="c1"># including lakes</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">o</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">outlets</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_routing</span> <span class="o">=</span> <span class="n">graph</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rno_routing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rno_routing</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing_changed</span><span class="p">():</span>
            <span class="c1"># enforce valid rnos; and create outreach connections</span>
            <span class="c1"># from segment data and sequential reach numbering</span>
            <span class="c1"># (ireach values also checked and fixed if necesseary)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_outreaches</span><span class="p">()</span>
            <span class="n">rd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">rno</span><span class="p">,</span> <span class="n">rd</span><span class="o">.</span><span class="n">outreach</span><span class="p">))</span>
            <span class="n">outlets</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>  <span class="c1"># including lakes</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">o</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">outlets</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rno_routing</span> <span class="o">=</span> <span class="n">graph</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rno_routing</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">modflow_sfr2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A `flopy.modflow.mfsfr2.ModflowSfr2` represenation of the sfr dataset.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ModflowSfr2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_modflow_sfr2</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ModflowSfr2</span>

<div class="viewcode-block" id="SFRData.get_empty_reach_data"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.get_empty_reach_data">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_empty_reach_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nreaches</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">rd</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">ModflowSfr2</span><span class="o">.</span><span class="n">get_empty_reach_data</span><span class="p">(</span><span class="n">nreaches</span><span class="p">,</span>
                                                 <span class="n">default_value</span><span class="o">=</span><span class="n">default_value</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rd</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">SFRData</span><span class="o">.</span><span class="n">rdcols</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_value</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">!=</span> <span class="s1">&#39;geometry&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">rdcols</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_setup_reach_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reach_data</span><span class="p">):</span>
        <span class="n">rd</span> <span class="o">=</span> <span class="n">SFRData</span><span class="o">.</span><span class="n">get_empty_reach_data</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reach_data</span><span class="p">))</span>
        <span class="n">reach_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reach_data</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">reach_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">rd</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">reach_data</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">SFRData</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
            <span class="k">assert</span> <span class="n">rd</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">SFRData</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="c1"># assign kwargs to reach data</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdcols</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reach_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">rd</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">rd</span>

<div class="viewcode-block" id="SFRData.get_empty_segment_data"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.get_empty_segment_data">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_empty_segment_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nsegments</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">ModflowSfr2</span><span class="o">.</span><span class="n">get_empty_segment_data</span><span class="p">(</span><span class="n">nsegments</span><span class="p">,</span>
                                                   <span class="n">default_value</span><span class="o">=</span><span class="n">default_value</span><span class="p">)</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sd</span><span class="p">)</span>
        <span class="n">sd</span><span class="p">[</span><span class="s1">&#39;per&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">sd</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">sd</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">sd</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">sd</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">sdcols</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_setup_segment_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segment_data</span><span class="p">):</span>
        <span class="c1"># if no segment_data was provided</span>
        <span class="k">if</span> <span class="n">segment_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># create segment_data from iseg and ireach columns in reach data</span>
            <span class="c1"># if</span>
            <span class="k">if</span> <span class="n">valid_nsegs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">iseg</span><span class="p">,</span> <span class="n">increasing</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">outseg</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;iseg&#39;</span><span class="p">,</span> <span class="s1">&#39;ireach&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">nss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">iseg</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="n">sd</span> <span class="o">=</span> <span class="n">SFRData</span><span class="o">.</span><span class="n">get_empty_segment_data</span><span class="p">(</span><span class="n">nss</span><span class="p">)</span>
                <span class="n">routing</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">iseg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">outseg</span><span class="p">))</span>
                <span class="n">sd</span><span class="p">[</span><span class="s1">&#39;nseg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sd</span><span class="p">))</span>
                <span class="n">sd</span><span class="p">[</span><span class="s1">&#39;outseg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">routing</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sd</span><span class="o">.</span><span class="n">nseg</span><span class="p">]</span>
            <span class="c1"># create segment_data from reach routing (one reach per segment)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">has_rno_routing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_reach_routing</span><span class="p">()</span>
                <span class="k">assert</span> <span class="n">has_rno_routing</span><span class="p">,</span> \
                    <span class="s2">&quot;Reach data must contain rno column with unique, &quot;</span> \
                    <span class="s2">&quot;consecutive reach numbers starting at 1. If no &quot;</span> \
                    <span class="s2">&quot;segment_data are supplied, segment routing must be&quot;</span> \
                    <span class="s2">&quot;included in iseg and outseg columns, or reach data &quot;</span> \
                    <span class="s2">&quot;must contain outreach column with routing connections.&quot;</span>
                <span class="n">sd</span> <span class="o">=</span> <span class="n">SFRData</span><span class="o">.</span><span class="n">get_empty_segment_data</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">))</span>
                <span class="n">sd</span><span class="p">[</span><span class="s1">&#39;nseg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">rno</span>
                <span class="n">sd</span><span class="p">[</span><span class="s1">&#39;outseg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">outreach</span>
        <span class="c1"># transfer supplied segment data to default template</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sd</span> <span class="o">=</span> <span class="n">SFRData</span><span class="o">.</span><span class="n">get_empty_segment_data</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">segment_data</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;per&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">segment_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">segment_data</span><span class="p">[</span><span class="s1">&#39;per&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">segment_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;per&#39;</span><span class="p">,</span> <span class="s1">&#39;nseg&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">segment_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">segment_data</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">segment_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">segment_data</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">SFRData</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
            <span class="c1"># fill any nan values with 0 (same as empty segment_data;</span>
            <span class="c1"># for example elevation if it wasn&#39;t specified and</span>
            <span class="c1"># will be sampled from the DEM)</span>
            <span class="n">values</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">sd</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>

        <span class="c1"># assign defaults to segment data</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sdcols</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">segment_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">sd</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="c1"># add outsegs to reach_data</span>
        <span class="n">routing</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">nseg</span><span class="p">,</span> <span class="n">sd</span><span class="o">.</span><span class="n">outseg</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">[</span><span class="s1">&#39;outseg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">routing</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">iseg</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">sd</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">observations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;obsname&#39;</span><span class="p">,</span> <span class="s1">&#39;obstype&#39;</span><span class="p">,</span> <span class="s1">&#39;rno&#39;</span><span class="p">,</span> <span class="s1">&#39;iseg&#39;</span><span class="p">,</span> <span class="s1">&#39;ireach&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observations</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">observations_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observations_filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="s1">&#39;mf6&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_observations_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_name</span> <span class="o">+</span> <span class="s1">&#39;.sfr.obs&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_observations_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_name</span> <span class="o">+</span> <span class="s1">&#39;.gage&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observations_filename</span>

    <span class="nd">@observations_file</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">observations_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observations_filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observations_filename</span> <span class="o">=</span> <span class="n">observations_filename</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">period_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_period_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_period_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_period_data</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_period_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">_period_data</span><span class="o">.</span><span class="n">rno</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_period_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_period_data</span><span class="o">.</span><span class="n">rno</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_period_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_period_data</span>

    <span class="k">def</span> <span class="nf">_get_period_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;converting segment data to period data...&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">segment_data_to_period_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">)</span>

<div class="viewcode-block" id="SFRData.add_to_perioddata"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.add_to_perioddata">[docs]</a>    <span class="k">def</span> <span class="nf">add_to_perioddata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">flowline_routing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">variable</span><span class="o">=</span><span class="s1">&#39;inflow&#39;</span><span class="p">,</span>
                          <span class="n">line_id_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">rno_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">period_column</span><span class="o">=</span><span class="s1">&#39;per&#39;</span><span class="p">,</span>
                          <span class="n">data_column</span><span class="o">=</span><span class="s1">&#39;Q_avg&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">add_to_perioddata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">flowline_routing</span><span class="o">=</span><span class="n">flowline_routing</span><span class="p">,</span>
                                 <span class="n">variable</span><span class="o">=</span><span class="n">variable</span><span class="p">,</span>
                                 <span class="n">line_id_column</span><span class="o">=</span><span class="n">line_id_column</span><span class="p">,</span>
                                 <span class="n">rno_column</span><span class="o">=</span><span class="n">rno_column</span><span class="p">,</span>
                                 <span class="n">period_column</span><span class="o">=</span><span class="n">period_column</span><span class="p">,</span>
                                 <span class="n">data_column</span><span class="o">=</span><span class="n">data_column</span><span class="p">)</span></div>

<div class="viewcode-block" id="SFRData.add_to_segment_data"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.add_to_segment_data">[docs]</a>    <span class="k">def</span> <span class="nf">add_to_segment_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">flowline_routing</span><span class="p">,</span>
                            <span class="n">variable</span><span class="o">=</span><span class="s1">&#39;flow&#39;</span><span class="p">,</span>
                            <span class="n">line_id_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">segment_column</span><span class="o">=</span><span class="s1">&#39;segment&#39;</span><span class="p">,</span>
                            <span class="n">period_column</span><span class="o">=</span><span class="s1">&#39;per&#39;</span><span class="p">,</span>
                            <span class="n">data_column</span><span class="o">=</span><span class="s1">&#39;Q_avg&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">add_to_segment_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">flowline_routing</span><span class="p">,</span>
                                   <span class="n">variable</span><span class="o">=</span><span class="n">variable</span><span class="p">,</span>
                                   <span class="n">line_id_column</span><span class="o">=</span><span class="n">line_id_column</span><span class="p">,</span>
                                   <span class="n">segment_column</span><span class="o">=</span><span class="n">segment_column</span><span class="p">,</span>
                                   <span class="n">period_column</span><span class="o">=</span><span class="n">period_column</span><span class="p">,</span>
                                   <span class="n">data_column</span><span class="o">=</span><span class="n">data_column</span><span class="p">)</span></div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">paths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dict listing routing sequence for each segment</span>
<span class="sd">        in SFR network.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paths</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_paths</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paths</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing_changed</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reset_routing</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paths</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reach_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dict listing routing sequence for each segment</span>
<span class="sd">        in SFR network.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paths</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_reach_paths</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reach_paths</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing_changed</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reset_routing</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reach_paths</span>

    <span class="k">def</span> <span class="nf">_set_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">routing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_routing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_paths</span> <span class="o">=</span> <span class="p">{</span><span class="n">seg</span><span class="p">:</span> <span class="n">find_path</span><span class="p">(</span><span class="n">routing</span><span class="p">,</span> <span class="n">seg</span><span class="p">)</span> <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">routing</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>

    <span class="k">def</span> <span class="nf">_set_reach_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">routing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rno_routing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reach_paths</span> <span class="o">=</span> <span class="p">{</span><span class="n">rno</span><span class="p">:</span> <span class="n">find_path</span><span class="p">(</span><span class="n">routing</span><span class="p">,</span> <span class="n">rno</span><span class="p">)</span> <span class="k">for</span> <span class="n">rno</span> <span class="ow">in</span> <span class="n">routing</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>

    <span class="k">def</span> <span class="nf">_reset_routing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_reaches</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_segments</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_segment_routing</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_paths</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rno_routing</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_reach_paths</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_routing_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;per&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">rd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span>
        <span class="c1"># check if segment routing in dataframe is consistent with routing dict</span>
        <span class="n">segment_routing</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">nseg</span><span class="p">,</span> <span class="n">sd</span><span class="o">.</span><span class="n">outseg</span><span class="p">))</span>
        <span class="n">segment_routing_changed</span> <span class="o">=</span> <span class="n">segment_routing</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segment_routing</span>

        <span class="c1"># check if reach routing in dataframe is consistent with routing dict</span>
        <span class="n">reach_routing</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">rno</span><span class="p">,</span> <span class="n">rd</span><span class="o">.</span><span class="n">outreach</span><span class="p">))</span>
        <span class="n">reach_routing_changed</span> <span class="o">=</span> <span class="n">reach_routing</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rno_routing</span>

        <span class="c1"># check if segment and reach routing in dataframe are consistent</span>
        <span class="n">consistent</span> <span class="o">=</span> <span class="n">rno_nseg_routing_consistent</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">nseg</span><span class="p">,</span> <span class="n">sd</span><span class="o">.</span><span class="n">outseg</span><span class="p">,</span>
                                                 <span class="n">rd</span><span class="o">.</span><span class="n">iseg</span><span class="p">,</span> <span class="n">rd</span><span class="o">.</span><span class="n">ireach</span><span class="p">,</span>
                                                 <span class="n">rd</span><span class="o">.</span><span class="n">rno</span><span class="p">,</span> <span class="n">rd</span><span class="o">.</span><span class="n">outreach</span><span class="p">)</span>
        <span class="c1"># return True if the dataframes changed,</span>
        <span class="c1"># or are inconsistent between segments and reach numbers</span>
        <span class="k">return</span> <span class="n">segment_routing_changed</span> <span class="o">&amp;</span> <span class="n">reach_routing_changed</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">consistent</span>

<div class="viewcode-block" id="SFRData.repair_outsegs"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.repair_outsegs">[docs]</a>    <span class="k">def</span> <span class="nf">repair_outsegs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set any outsegs that are not nsegs or lakes to 0 (outlet status)&quot;&quot;&quot;</span>
        <span class="n">isasegment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">outseg</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">nseg</span><span class="p">)</span>
        <span class="n">isasegment</span> <span class="o">=</span> <span class="n">isasegment</span> <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">outseg</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">isasegment</span><span class="p">,</span> <span class="s1">&#39;outseg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="SFRData.reset_segments"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.reset_segments">[docs]</a>    <span class="k">def</span> <span class="nf">reset_segments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset the segment numbering so that is consecutive,</span>
<span class="sd">        starts at 1 and only increases downstream.&quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">renumber_segments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">nseg</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">outseg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="p">[</span><span class="s1">&#39;nseg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">nseg</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="p">[</span><span class="s1">&#39;outseg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">outseg</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">[</span><span class="s1">&#39;iseg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">iseg</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">[</span><span class="s1">&#39;outseg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">outseg</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;per&#39;</span><span class="p">,</span> <span class="s1">&#39;nseg&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">per</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;nseg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">per</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;iseg&#39;</span><span class="p">,</span> <span class="s1">&#39;ireach&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="SFRData.reset_reaches"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.reset_reaches">[docs]</a>    <span class="k">def</span> <span class="nf">reset_reaches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ensure that the reaches in each segment are numbered</span>
<span class="sd">        consecutively starting at 1.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;iseg&#39;</span><span class="p">,</span> <span class="s1">&#39;ireach&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">reach_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span>
        <span class="n">segment_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;per&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">reach_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">reach_data</span><span class="o">.</span><span class="n">iseg</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">reach_counts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">reach_counts</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                                <span class="n">reach_counts</span><span class="p">))</span>
        <span class="n">ireach</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">reach_counts</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                  <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">segment_data</span><span class="o">.</span><span class="n">nseg</span><span class="p">]</span>
        <span class="n">ireach</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">ireach</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">[</span><span class="s1">&#39;ireach&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ireach</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">j</span><span class="o">=</span><span class="mi">2</span></div>

<div class="viewcode-block" id="SFRData.set_outreaches"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.set_outreaches">[docs]</a>    <span class="k">def</span> <span class="nf">set_outreaches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine the outreach for each SFR reach (requires a rno column in reach_data).</span>
<span class="sd">        Uses the segment routing specified for the first stress period to route reaches between segments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;iseg&#39;</span><span class="p">,</span> <span class="s1">&#39;ireach&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;per&#39;</span><span class="p">,</span> <span class="s1">&#39;nseg&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_rnos</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">[</span><span class="s1">&#39;rno&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_reaches</span><span class="p">()</span>  <span class="c1"># ensure that each segment starts with reach 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repair_outsegs</span><span class="p">()</span>  <span class="c1"># ensure that all outsegs are segments, outlets, or negative (lakes)</span>
        <span class="n">rd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span>
        <span class="n">outseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_routing</span>
        <span class="n">reach1IDs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rd</span><span class="p">[</span><span class="n">rd</span><span class="o">.</span><span class="n">ireach</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">iseg</span><span class="p">,</span>
                             <span class="n">rd</span><span class="p">[</span><span class="n">rd</span><span class="o">.</span><span class="n">ireach</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rno</span><span class="p">))</span>
        <span class="n">ireach</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">ireach</span><span class="o">.</span><span class="n">values</span>
        <span class="n">iseg</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">iseg</span><span class="o">.</span><span class="n">values</span>
        <span class="n">rno</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rno</span><span class="o">.</span><span class="n">values</span>
        <span class="n">outreach</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rd</span><span class="p">)):</span>
            <span class="c1"># if at the end of reach data or current segment</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">rd</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ireach</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">nextseg</span> <span class="o">=</span> <span class="n">outseg</span><span class="p">[</span><span class="n">iseg</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>  <span class="c1"># get next segment</span>
                <span class="k">if</span> <span class="n">nextseg</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># current reach is not an outlet</span>
                    <span class="n">nextrchid</span> <span class="o">=</span> <span class="n">reach1IDs</span><span class="p">[</span><span class="n">nextseg</span><span class="p">]</span>  <span class="c1"># get reach 1 of next segment</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nextrchid</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># otherwise, it&#39;s the next rno</span>
                <span class="n">nextrchid</span> <span class="o">=</span> <span class="n">rno</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">outreach</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nextrchid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">[</span><span class="s1">&#39;outreach&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outreach</span></div>

    <span class="k">def</span> <span class="nf">_valid_rnos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">incols</span> <span class="o">=</span> <span class="s1">&#39;rno&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">arevalid</span> <span class="o">=</span> <span class="n">valid_rnos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">rno</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">incols</span> <span class="o">&amp;</span> <span class="n">arevalid</span>

    <span class="k">def</span> <span class="nf">_check_reach_routing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cursory check of reach routing.&quot;&quot;&quot;</span>
        <span class="n">valid_rnos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_rnos</span><span class="p">()</span>
        <span class="n">non_zero_outreaches</span> <span class="o">=</span> <span class="s1">&#39;outreach&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">&amp;</span> \
                              <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">outreach</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">valid_rnos</span> <span class="o">&amp;</span> <span class="n">non_zero_outreaches</span>

    <span class="k">def</span> <span class="nf">_valid_nsegs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">increasing</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">sd0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">per</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">valid_nsegs</span><span class="p">(</span><span class="n">sd0</span><span class="o">.</span><span class="n">nseg</span><span class="p">,</span>
                           <span class="n">sd0</span><span class="o">.</span><span class="n">outseg</span><span class="p">,</span>
                           <span class="n">increasing</span><span class="o">=</span><span class="n">increasing</span><span class="p">)</span>

<div class="viewcode-block" id="SFRData.assign_layers"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.assign_layers">[docs]</a>    <span class="k">def</span> <span class="nf">assign_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adjusted_botm_output_path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assign model layers to SFR reaches, using the discretzation</span>
<span class="sd">        package in the attached model. New botm elevations for the model</span>
<span class="sd">        will be written to a text array file, if any streambed bottoms</span>
<span class="sd">        are below the model bottom.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        adjusted_botm_output_path : str</span>
<span class="sd">            Path for writing the text array of adjusted model bottom</span>
<span class="sd">            elevations, by default, &#39;.&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;dis&#39;</span><span class="p">):</span>
            <span class="n">botm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">botm</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">nlay</span> <span class="o">=</span> <span class="n">botm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">layers</span><span class="p">,</span> <span class="n">new_botm</span> <span class="o">=</span> <span class="n">assign_layers</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">,</span> <span class="n">botm_array</span><span class="o">=</span><span class="n">botm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layers</span>
            <span class="k">if</span> <span class="n">new_botm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">outfile</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_layer_</span><span class="si">{}</span><span class="s1">_new_botm_elevations.dat&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">,</span>
                                                                       <span class="n">nlay</span><span class="p">)</span>
                <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">adjusted_botm_output_path</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">new_botm</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Sfrmaker pushed some model botm elevations downward&#39;</span>
                       <span class="s1">&#39;to accomodate streambed bottoms. New botm elevations&#39;</span>
                       <span class="s1">&#39;for layer </span><span class="si">{}</span><span class="s1"> written to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nlay</span><span class="p">,</span> <span class="n">outfile</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Need a model instance with a discretization package to assign layers. &#39;</span>
                  <span class="s1">&#39;A model can be assigned to the SFRData.model attribute.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SFRData.create_modflow_sfr2"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.create_modflow_sfr2">[docs]</a>    <span class="k">def</span> <span class="nf">create_modflow_sfr2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">isfropt</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># override flopy default of 0</span>
                            <span class="n">unit_number</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">ipakcb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">istcb2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">kwargs</span>
                            <span class="p">):</span>

        <span class="k">if</span> <span class="n">const</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">const</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">const</span>

        <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">model</span><span class="o">.</span><span class="n">version</span> <span class="o">!=</span> <span class="s1">&#39;mf6&#39;</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">model</span>
        <span class="c1"># create an flopy mf2005 model instance attached to modflow_sfr2 object</span>
        <span class="c1"># this is a parallel model instance to self.model, that is only</span>
        <span class="c1"># accessible through modflow_sfr2.parent. As long as this method is</span>
        <span class="c1"># called by the @model.setter; this instance should have the same</span>
        <span class="c1"># dis and ibound (idomain) as self.model.</span>
        <span class="c1"># The modflow_sfr2 instance is used as basis for writing packages,</span>
        <span class="c1"># because it includes many features, like checking and exporting,</span>
        <span class="c1"># that ModflowGwfsfr doesn&#39;t have)</span>
        <span class="c1"># ibound in BAS package is used by mf5to6 converter</span>
        <span class="c1"># to fill in required &quot;None&quot; values when writing mf6 input</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">model</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="s1">&#39;mf6&#39;</span><span class="p">:</span>
            <span class="n">model_ws</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span> <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">model</span><span class="o">.</span><span class="n">model_ws</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">Modflow</span><span class="p">(</span><span class="n">modelname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">,</span> <span class="n">model_ws</span><span class="o">=</span><span class="n">model_ws</span><span class="p">,</span>
                           <span class="n">structured</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">structured</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">nper</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="s1">&#39;tdis&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">package_key_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">tdis</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">package_key_dict</span><span class="p">[</span><span class="s1">&#39;tdis&#39;</span><span class="p">]</span>
                    <span class="n">nper</span> <span class="o">=</span> <span class="n">tdis</span><span class="o">.</span><span class="n">nper</span><span class="o">.</span><span class="n">array</span>
                <span class="k">if</span> <span class="s1">&#39;dis&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">package_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">dis</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">dis</span>
                    <span class="n">botm</span> <span class="o">=</span> <span class="n">dis</span><span class="o">.</span><span class="n">botm</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">idomain</span> <span class="o">=</span> <span class="n">dis</span><span class="o">.</span><span class="n">idomain</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">nlay</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="n">botm</span><span class="o">.</span><span class="n">shape</span>
                    <span class="n">dis</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">ModflowDis</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">nlay</span><span class="o">=</span><span class="n">nlay</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="n">ncol</span><span class="p">,</span> <span class="n">nper</span><span class="o">=</span><span class="n">nper</span><span class="p">,</span>
                                        <span class="n">top</span><span class="o">=</span><span class="n">dis</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                                        <span class="n">botm</span><span class="o">=</span><span class="n">botm</span><span class="p">)</span>
                    <span class="n">bas</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">ModflowBas</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">ibound</span><span class="o">=</span><span class="n">idomain</span><span class="p">)</span>

        <span class="c1"># translate segment data</span>
        <span class="c1"># populate MODFLOW 2005 segment variables from reach data if they weren&#39;t entered</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="p">[[</span><span class="s1">&#39;width1&#39;</span><span class="p">,</span> <span class="s1">&#39;width2&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Double check indexing below before using this option.&#39;</span><span class="p">)</span>
            <span class="n">width1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;iseg&#39;</span><span class="p">)[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
            <span class="n">width2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;iseg&#39;</span><span class="p">)[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="p">[</span><span class="s1">&#39;width1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">width1</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">nseg</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="p">[</span><span class="s1">&#39;width2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">width2</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">nseg</span><span class="p">]</span>

        <span class="k">assert</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="p">))</span>
        
        <span class="c1"># create record array for each stress period</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;per&#39;</span><span class="p">)</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="p">{</span><span class="n">per</span><span class="p">:</span> <span class="n">sd</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">per</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;per&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_records</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
              <span class="k">for</span> <span class="n">per</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">per</span><span class="o">.</span><span class="n">unique</span><span class="p">()}</span>

        <span class="c1"># translate reach data</span>
        <span class="n">flopy_cols</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">ModflowSfr2</span><span class="o">.</span> \
            <span class="n">get_default_reach_dtype</span><span class="p">(</span><span class="n">structured</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">structured</span><span class="p">)</span><span class="o">.</span><span class="n">names</span>
        <span class="n">columns_not_in_flopy</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">flopy_cols</span><span class="p">))</span>
        <span class="n">rd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns_not_in_flopy</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">rd</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">to_records</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">nstrm</span> <span class="o">=</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">rd</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ModflowSfr2</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">ModflowSfr2</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">nstrm</span><span class="o">=</span><span class="n">nstrm</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="n">const</span><span class="p">,</span>
                                           <span class="n">reach_data</span><span class="o">=</span><span class="n">rd</span><span class="p">,</span> <span class="n">segment_data</span><span class="o">=</span><span class="n">sd</span><span class="p">,</span>
                                           <span class="n">isfropt</span><span class="o">=</span><span class="n">isfropt</span><span class="p">,</span> <span class="n">unit_number</span><span class="o">=</span><span class="n">unit_number</span><span class="p">,</span>
                                           <span class="n">ipakcb</span><span class="o">=</span><span class="n">ipakcb</span><span class="p">,</span> <span class="n">istcb2</span><span class="o">=</span><span class="n">istcb2</span><span class="p">,</span>
                                           <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># if model.version == &#39;mf6&#39;:</span>
        <span class="c1">#    self._ModflowSfr2.parent = model</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ModflowSfr2</span></div>

<div class="viewcode-block" id="SFRData.create_mf6sfr"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.create_mf6sfr">[docs]</a>    <span class="k">def</span> <span class="nf">create_mf6sfr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unit_conversion</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">stage_filerecord</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">budget_filerecord</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">flopy_rno_input_is_zero_based</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">kwargs</span>
                      <span class="p">):</span>

        <span class="k">if</span> <span class="n">unit_conversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">unit_conversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">const</span>
        <span class="k">if</span> <span class="n">stage_filerecord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stage_filerecord</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.sfr.stage.bin&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">budget_filerecord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">budget_filerecord</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.sfr.cbc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">model</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="s1">&#39;mf6&#39;</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">model</span>
            <span class="k">if</span> <span class="s1">&#39;tdis&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">package_key_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">tdis</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">package_key_dict</span><span class="p">[</span><span class="s1">&#39;tdis&#39;</span><span class="p">]</span>
                <span class="n">nper</span> <span class="o">=</span> <span class="n">tdis</span><span class="o">.</span><span class="n">nper</span><span class="o">.</span><span class="n">array</span>
        <span class="c1"># create an flopy mf2005 model instance attached to modflow_sfr2 object</span>
        <span class="c1"># this is a parallel model instance to self.model, that is only</span>
        <span class="c1"># accessible through modflow_sfr2.parent. As long as this method is</span>
        <span class="c1"># called by the @model.setter; this instance should have the same</span>
        <span class="c1"># dis and ibound (idomain) as self.model.</span>
        <span class="c1"># The modflow_sfr2 instance is used as basis for writing packages,</span>
        <span class="c1"># because it includes many features, like checking and exporting,</span>
        <span class="c1"># that ModflowGwfsfr doesn&#39;t have)</span>
        <span class="c1"># ibound in BAS package is used by mf5to6 converter</span>
        <span class="c1"># to fill in required &quot;None&quot; values when writing mf6 input</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">model</span><span class="o">.</span><span class="n">version</span> <span class="o">!=</span> <span class="s1">&#39;mf6&#39;</span><span class="p">:</span>
            <span class="c1"># create simulation</span>
            <span class="n">sim</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">mf6</span><span class="o">.</span><span class="n">MFSimulation</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s1">&#39;mf6&#39;</span><span class="p">,</span> <span class="n">exe_name</span><span class="o">=</span><span class="s1">&#39;mf6&#39;</span><span class="p">,</span>
                                         <span class="n">sim_ws</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwf</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>

        <span class="c1"># create an sfrmaker.Mf6SFR instance</span>
        <span class="kn">from</span> <span class="nn">.mf5to6</span> <span class="kn">import</span> <span class="n">Mf6SFR</span>

        <span class="n">sfr6</span> <span class="o">=</span> <span class="n">Mf6SFR</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modflow_sfr2</span><span class="p">)</span>

        <span class="c1"># package data</span>
        <span class="c1"># An error occurred when storing data &quot;packagedata&quot; in a recarray.</span>
        <span class="c1"># packagedata data is a one or two dimensional list containing the variables</span>
        <span class="c1"># &quot;&lt;rno&gt; &lt;cellid&gt; &lt;rlen&gt; &lt;rwid&gt; &lt;rgrd&gt; &lt;rtp&gt; &lt;rbth&gt; &lt;rhk&gt; &lt;man&gt; &lt;ncon&gt; &lt;ustrf&gt; &lt;ndv&gt;&quot;</span>
        <span class="c1"># (some variables may be optional, see MF6 documentation)</span>
        <span class="n">packagedata</span> <span class="o">=</span> <span class="n">sfr6</span><span class="o">.</span><span class="n">packagedata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structured</span><span class="p">:</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="n">packagedata</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;j&#39;</span><span class="p">,</span> <span class="s1">&#39;idomain&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">packagedata</span><span class="p">[</span><span class="s1">&#39;cellid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">packagedata</span><span class="o">.</span><span class="n">k</span><span class="p">,</span>
                                             <span class="n">packagedata</span><span class="o">.</span><span class="n">i</span><span class="p">,</span>
                                             <span class="n">packagedata</span><span class="o">.</span><span class="n">j</span><span class="p">))</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;cellid&#39;</span><span class="p">)</span>

        <span class="n">connectiondata</span> <span class="o">=</span> <span class="p">[(</span><span class="n">rno</span><span class="p">,</span> <span class="o">*</span><span class="n">sfr6</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">rno</span><span class="p">])</span>
                          <span class="k">for</span> <span class="n">rno</span> <span class="ow">in</span> <span class="n">sfr6</span><span class="o">.</span><span class="n">packagedata</span><span class="o">.</span><span class="n">rno</span> <span class="k">if</span> <span class="n">rno</span> <span class="ow">in</span> <span class="n">sfr6</span><span class="o">.</span><span class="n">connections</span><span class="p">]</span>
        <span class="c1"># as of 9/12/2019, flopy.mf6.modflow.ModflowGwfsfr requires zero-based input for rno</span>
        <span class="k">if</span> <span class="n">flopy_rno_input_is_zero_based</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">modflow_sfr2</span><span class="o">.</span><span class="n">reach_data</span><span class="p">[</span><span class="s1">&#39;reachID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">packagedata</span><span class="p">[</span><span class="s1">&#39;rno&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">zero_based_connectiondata</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">connectiondata</span><span class="p">:</span>
                <span class="n">zero_based_record</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">rno</span> <span class="ow">in</span> <span class="n">record</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rno</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">rno</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">rno</span> <span class="o">-=</span> <span class="mi">1</span>
                        <span class="k">elif</span> <span class="n">rno</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">rno</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">zero_based_record</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rno</span><span class="p">)</span>
                <span class="c1">#zero_based_record = tuple(i - 1 if i &gt; 0 else i + 1 for i in record)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zero_based_record</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">zero_based_record</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">zero_based_connectiondata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zero_based_record</span><span class="p">)</span>
            <span class="n">connectiondata</span> <span class="o">=</span> <span class="n">zero_based_connectiondata</span>
        <span class="k">assert</span> <span class="n">packagedata</span><span class="p">[</span><span class="s1">&#39;rno&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="c1">#assert np.min(list(map(np.min, map(np.abs, connectiondata)))) &lt; 1</span>

        <span class="c1"># set cellids to None for unconnected reaches or where idomain == 0</span>
        <span class="c1"># can only do this with flopy versions 3.3.1 and later, otherwise flopy will bomb</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">flopy</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;3.3.0&#39;</span><span class="p">):</span>
            <span class="n">unconnected</span> <span class="o">=</span> <span class="o">~</span><span class="n">packagedata</span><span class="p">[</span><span class="s1">&#39;rno&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sfr6</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
            <span class="n">inactive</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">idomain</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">packagedata</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                           <span class="n">packagedata</span><span class="o">.</span><span class="n">i</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                           <span class="n">packagedata</span><span class="o">.</span><span class="n">j</span><span class="o">.</span><span class="n">values</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span>
            <span class="n">packagedata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">unconnected</span> <span class="o">|</span> <span class="n">inactive</span><span class="p">,</span> <span class="s1">&#39;cellid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">packagedata</span> <span class="o">=</span> <span class="n">packagedata</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">period_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">sfr6</span><span class="o">.</span><span class="n">period_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># TODO: add method to convert period_data df to MF6 input</span>
            <span class="c1"># raise NotImplemented(&quot;Support for mf6 period_data input not implemented yet. &quot;</span>
            <span class="c1">#                     &quot;Use sfrdata.write_package(version=&#39;mf6&#39;) instead.&quot;)</span>
            <span class="k">pass</span>

        <span class="n">mf6sfr</span> <span class="o">=</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwfsfr</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">unit_conversion</span><span class="o">=</span><span class="n">unit_conversion</span><span class="p">,</span>
                                   <span class="n">stage_filerecord</span><span class="o">=</span><span class="n">stage_filerecord</span><span class="p">,</span>
                                   <span class="n">budget_filerecord</span><span class="o">=</span><span class="n">budget_filerecord</span><span class="p">,</span>
                                   <span class="n">nreaches</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">),</span>
                                   <span class="n">packagedata</span><span class="o">=</span><span class="n">packagedata</span><span class="p">,</span>
                                   <span class="n">connectiondata</span><span class="o">=</span><span class="n">connectiondata</span><span class="p">,</span>
                                   <span class="n">diversions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># TODO: add support for diversions</span>
                                   <span class="n">perioddata</span><span class="o">=</span><span class="n">period_data</span><span class="p">,</span>  <span class="c1"># TODO: add support for creating mf6 perioddata input</span>
                                   <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mf6sfr</span></div>

<div class="viewcode-block" id="SFRData.add_observations"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.add_observations">[docs]</a>    <span class="k">def</span> <span class="nf">add_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">flowline_routing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">obstype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sfrlines_shapefile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">x_location_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">y_location_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">line_id_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">rno_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">obstype_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">obsname_column</span><span class="o">=</span><span class="s1">&#39;site_no&#39;</span><span class="p">):</span>

         <span class="n">added_obs</span> <span class="o">=</span> <span class="n">add_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">flowline_routing</span><span class="o">=</span><span class="n">flowline_routing</span><span class="p">,</span>
                                      <span class="n">obstype</span><span class="o">=</span><span class="n">obstype</span><span class="p">,</span> <span class="n">sfrlines_shapefile</span><span class="o">=</span><span class="n">sfrlines_shapefile</span><span class="p">,</span>
                                      <span class="n">x_location_column</span><span class="o">=</span><span class="n">x_location_column</span><span class="p">,</span>
                                      <span class="n">y_location_column</span><span class="o">=</span><span class="n">y_location_column</span><span class="p">,</span>
                                      <span class="n">line_id_column</span><span class="o">=</span><span class="n">line_id_column</span><span class="p">,</span>
                                      <span class="n">rno_column</span><span class="o">=</span><span class="n">rno_column</span><span class="p">,</span>
                                      <span class="n">obstype_column</span><span class="o">=</span><span class="n">obstype_column</span><span class="p">,</span>
                                      <span class="n">obsname_column</span><span class="o">=</span><span class="n">obsname_column</span><span class="p">)</span>

         <span class="c1"># replace any observations that area already in the observations table</span>
         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_observations</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
             <span class="n">exists_already</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observations</span><span class="p">[</span><span class="s1">&#39;obsname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">added_obs</span><span class="p">[</span><span class="s1">&#39;obsname&#39;</span><span class="p">])</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_observations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">exists_already</span><span class="p">]</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">_observations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">added_obs</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

         <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observations</span><span class="p">,</span> <span class="n">added_obs</span><span class="p">:</span>
             <span class="c1"># enforce dtypes (pandas doesn&#39;t allow an empty dataframe</span>
             <span class="c1"># to be initialized with more than one specified dtype)</span>
             <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rno&#39;</span><span class="p">,</span> <span class="s1">&#39;iseg&#39;</span><span class="p">,</span> <span class="s1">&#39;ireach&#39;</span><span class="p">]:</span>
                 <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
         <span class="k">return</span> <span class="n">added_obs</span></div>

<div class="viewcode-block" id="SFRData.interpolate_to_reaches"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.interpolate_to_reaches">[docs]</a>    <span class="k">def</span> <span class="nf">interpolate_to_reaches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segvar1</span><span class="p">,</span> <span class="n">segvar2</span><span class="p">,</span> <span class="n">per</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Interpolate values in datasets 6b and 6c to each reach in stream segment</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        segvar1 : str</span>
<span class="sd">            Column/variable name in segment_data array for representing start of segment</span>
<span class="sd">            (e.g. hcond1 for hydraulic conductivity)</span>
<span class="sd">            For segments with icalc=2 (specified channel geometry); if width1 is given,</span>
<span class="sd">            the eigth distance point (XCPT8) from dataset 6d will be used as the stream width.</span>
<span class="sd">            For icalc=3, an abitrary width of 5 is assigned.</span>
<span class="sd">            For icalc=4, the mean value for width given in item 6e is used.</span>
<span class="sd">        segvar2 : str</span>
<span class="sd">            Column/variable name in segment_data array for representing start of segment</span>
<span class="sd">            (e.g. hcond2 for hydraulic conductivity)</span>
<span class="sd">        per : int</span>
<span class="sd">            Stress period with segment data to interpolate</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        reach_values : 1D array</span>
<span class="sd">            One dimmensional array of interpolated values of same length as reach_data array.</span>
<span class="sd">            For example, hcond1 and hcond2 could be entered as inputs to get values for the</span>
<span class="sd">            strhc1 (hydraulic conductivity) column in reach_data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">sfrmaker.reaches</span> <span class="kn">import</span> <span class="n">interpolate_to_reaches</span>

        <span class="n">reach_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span>
        <span class="n">segment_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;per&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">per</span><span class="p">)</span>
        <span class="n">segment_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;nseg&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">reach_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;iseg&#39;</span><span class="p">,</span> <span class="s1">&#39;ireach&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">interpolate_to_reaches</span><span class="p">(</span><span class="n">reach_data</span><span class="p">,</span> <span class="n">segment_data</span><span class="p">,</span>
                                      <span class="n">segvar1</span><span class="p">,</span> <span class="n">segvar2</span><span class="p">,</span>
                                      <span class="n">reach_data_group_col</span><span class="o">=</span><span class="s1">&#39;iseg&#39;</span><span class="p">,</span>
                                      <span class="n">segment_data_group_col</span><span class="o">=</span><span class="s1">&#39;nseg&#39;</span>
                                      <span class="p">)</span></div>

<div class="viewcode-block" id="SFRData.isfropt0_to_1"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.isfropt0_to_1">[docs]</a>    <span class="k">def</span> <span class="nf">isfropt0_to_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;transfer isfropt=0 segment properties to reaches,</span>
<span class="sd">        using linear interpolation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">snames</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;strtop&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;elevup&#39;</span><span class="p">,</span> <span class="s1">&#39;elevdn&#39;</span><span class="p">),</span>
                  <span class="s1">&#39;strthick&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;thickm1&#39;</span><span class="p">,</span> <span class="s1">&#39;thickm2&#39;</span><span class="p">),</span>
                  <span class="s1">&#39;strhc1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;hcond1&#39;</span><span class="p">,</span> <span class="s1">&#39;hcond2&#39;</span><span class="p">),</span>
                  <span class="s1">&#39;thts&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;thts1&#39;</span><span class="p">,</span> <span class="s1">&#39;thts2&#39;</span><span class="p">),</span>
                  <span class="s1">&#39;thti&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;thti1&#39;</span><span class="p">,</span> <span class="s1">&#39;thti2&#39;</span><span class="p">),</span>
                  <span class="s1">&#39;eps&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;eps1&#39;</span><span class="p">,</span> <span class="s1">&#39;eps2&#39;</span><span class="p">),</span>
                  <span class="s1">&#39;uhc&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;uhc1&#39;</span><span class="p">,</span> <span class="s1">&#39;uhc2&#39;</span><span class="p">),</span>
                  <span class="p">}</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">per</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">sdcols</span> <span class="ow">in</span> <span class="n">snames</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> \
                    <span class="n">sd</span><span class="p">[[</span><span class="o">*</span><span class="n">sdcols</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolate_to_reaches</span><span class="p">(</span><span class="o">*</span><span class="n">sdcols</span><span class="p">)</span></div>

<div class="viewcode-block" id="SFRData.sample_reach_elevations"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.sample_reach_elevations">[docs]</a>    <span class="k">def</span> <span class="nf">sample_reach_elevations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dem</span><span class="p">,</span> <span class="n">dem_z_units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">method</span><span class="o">=</span><span class="s1">&#39;buffers&#39;</span><span class="p">,</span>
                                <span class="n">buffer_distance</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                <span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span>
                                <span class="n">smooth</span><span class="o">=</span><span class="kc">True</span>
                                <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes zonal statistics on a raster for SFR reaches, using</span>
<span class="sd">        either buffer polygons around the reach LineStrings, or the model</span>
<span class="sd">        grid cell polygons containing each reach.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dem : path to valid raster dataset</span>
<span class="sd">            Must be in same Coordinate Reference System as model grid.</span>
<span class="sd">        dem_z_units : str</span>
<span class="sd">            Elevation units for DEM (&#39;feet&#39; or &#39;meters&#39;). If None, units</span>
<span class="sd">            are assumed to be same as model (default).</span>
<span class="sd">        method : str; &#39;buffers&#39; or &#39;cell polygons&#39;</span>
<span class="sd">            If &#39;buffers&#39;, buffers (with flat caps; cap_style=2 in LineString.buffer())</span>
<span class="sd">            will be created around the reach LineStrings (geometry column in reach_data).</span>
<span class="sd">        buffer_distance : float</span>
<span class="sd">            Buffer distance to apply around reach LineStrings, in crs_units.</span>
<span class="sd">        statistic : str</span>
<span class="sd">            &quot;stats&quot; argument to rasterstats.zonal_stats.</span>
<span class="sd">            &quot;min&quot; is recommended for streambed elevations (default).</span>
<span class="sd">        smooth : bool</span>
<span class="sd">            Run sfrmaker.elevations.smooth_elevations on sampled elevations</span>
<span class="sd">            to ensure that they decrease monotonically in the downstream direction</span>
<span class="sd">            (default=True).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        elevs : dict of sampled elevations keyed by reach number</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get the CRS and pixel size for the DEM</span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">dem</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
            <span class="n">raster_crs</span> <span class="o">=</span> <span class="n">get_authority_crs</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>

            <span class="c1"># make sure buffer is large enough for DEM pixel size</span>
            <span class="n">buffer_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span>
                                              <span class="n">src</span><span class="o">.</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1.01</span><span class="p">,</span>
                                      <span class="n">buffer_distance</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;buffers&#39;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">LineString</span><span class="p">),</span> \
                <span class="s2">&quot;Need LineString geometries in reach_data.geometry column to use buffer option.&quot;</span>
            <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer_distance</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">geometry</span><span class="p">]</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;buffered LineStrings&#39;</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;cell polygons&#39;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> \
                <span class="s2">&quot;Need an attached sfrmaker.Grid instance to use cell polygons option.&quot;</span>
            <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">method</span>

        <span class="c1"># to_crs features if they&#39;re not in the same crs</span>
        <span class="k">if</span> <span class="n">raster_crs</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">:</span>
            <span class="n">features</span> <span class="o">=</span> <span class="n">project</span><span class="p">(</span><span class="n">features</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
                               <span class="n">raster_crs</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;running rasterstats.zonal_stats on </span><span class="si">{}</span><span class="s1">...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">txt</span><span class="p">))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">zonal_stats</span><span class="p">(</span><span class="n">features</span><span class="p">,</span>
                              <span class="n">dem</span><span class="p">,</span>
                              <span class="n">stats</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
        <span class="n">elevs</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;finished in </span><span class="si">{:.2f}</span><span class="s2">s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">elevs</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No </span><span class="si">{}</span><span class="s1"> intersected with </span><span class="si">{}</span><span class="s1">. Check projections.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="n">dem</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">elevs</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Some </span><span class="si">{}</span><span class="s1"> not intersected with </span><span class="si">{}</span><span class="s1">. &#39;</span>
                            <span class="s1">&#39;Check that DEM covers the area of the stream network.&#39;</span>
                            <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="n">dem</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">smooth</span><span class="p">:</span>
            <span class="n">elevs</span> <span class="o">=</span> <span class="n">smooth_elevations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">rno</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">outreach</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                                      <span class="n">elevs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elevs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">rno</span><span class="p">,</span> <span class="n">elevs</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">elevs</span></div>

<div class="viewcode-block" id="SFRData.set_streambed_top_elevations_from_dem"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.set_streambed_top_elevations_from_dem">[docs]</a>    <span class="k">def</span> <span class="nf">set_streambed_top_elevations_from_dem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dem</span><span class="p">,</span> <span class="n">dem_z_units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                              <span class="n">method</span><span class="o">=</span><span class="s1">&#39;buffers&#39;</span><span class="p">,</span>
                                              <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set streambed top elevations from a DEM raster.</span>
<span class="sd">        Runs sfrdata.sample_reach_elevations</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dem : path to valid raster dataset</span>
<span class="sd">            Must be in same Coordinate Reference System as model grid.</span>
<span class="sd">        dem_z_units : str</span>
<span class="sd">            Elevation units for DEM (&#39;feet&#39; or &#39;meters&#39;). If None, units</span>
<span class="sd">            are assumed to be same as model (default).</span>
<span class="sd">        method : str; &#39;buffers&#39; or &#39;cell polygons&#39;</span>
<span class="sd">            If &#39;buffers&#39;, buffers (with flat caps; cap_style=2 in LineString.buffer())</span>
<span class="sd">            will be created around the reach LineStrings (geometry column in reach_data).</span>
<span class="sd">        kwargs : keyword arguments to sfrdata.sample_reach_elevations</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        updates strtop column of sfrdata.reach_data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sampled_elevs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_reach_elevations</span><span class="p">(</span><span class="n">dem</span><span class="o">=</span><span class="n">dem</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                                     <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dem_z_units</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dem_z_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_length_units</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="n">convert_length_units</span><span class="p">(</span><span class="n">dem_z_units</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_length_units</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">[</span><span class="s1">&#39;strtop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">sampled_elevs</span><span class="p">[</span><span class="n">rno</span><span class="p">]</span>
                                     <span class="k">for</span> <span class="n">rno</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">[</span><span class="s1">&#39;rno&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">[</span><span class="s1">&#39;strtop&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">mult</span></div>

<div class="viewcode-block" id="SFRData.get_slopes"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.get_slopes">[docs]</a>    <span class="k">def</span> <span class="nf">get_slopes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_slope</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">minimum_slope</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span>
                   <span class="n">maximum_slope</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute slopes by reach using values in strtop (streambed top) and rchlen (reach length)</span>
<span class="sd">        columns of reach_data. The slope for a reach n is computed as strtop(n+1) - strtop(n) / rchlen(n).</span>
<span class="sd">        Slopes for outlet reaches are set equal to a default value (default_slope).</span>
<span class="sd">        Populates the slope column in reach_data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        default_slope : float</span>
<span class="sd">            Slope value applied to outlet reaches (where water leaves the model).</span>
<span class="sd">            Default value is 0.001</span>
<span class="sd">        minimum_slope : float</span>
<span class="sd">            Assigned to reaches with computed slopes less than this value.</span>
<span class="sd">            This ensures that the Manning&#39;s equation won&#39;t produce unreasonable values of stage</span>
<span class="sd">            (in other words, that stage is consistent with assumption that</span>
<span class="sd">            streamflow is primarily drive by the streambed gradient).</span>
<span class="sd">            Default value is 0.0001.</span>
<span class="sd">        maximum_slope : float</span>
<span class="sd">            Assigned to reaches with computed slopes more than this value.</span>
<span class="sd">            Default value is 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span>
        <span class="k">assert</span> <span class="n">rd</span><span class="o">.</span><span class="n">outreach</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;requires reach routing, must be called after set_outreaches()&quot;</span>
        <span class="n">elev</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">rno</span><span class="p">,</span> <span class="n">rd</span><span class="o">.</span><span class="n">strtop</span><span class="p">))</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">rno</span><span class="p">,</span> <span class="n">rd</span><span class="o">.</span><span class="n">rchlen</span><span class="p">))</span>
        <span class="n">dnelev</span> <span class="o">=</span> <span class="p">{</span><span class="n">rid</span><span class="p">:</span> <span class="n">elev</span><span class="p">[</span><span class="n">rd</span><span class="o">.</span><span class="n">outreach</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">if</span> <span class="n">rd</span><span class="o">.</span><span class="n">outreach</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="k">else</span> <span class="o">-</span><span class="mi">9999</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">rno</span><span class="p">)}</span>
        <span class="n">slopes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">elev</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dnelev</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">dnelev</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9999</span> <span class="ow">and</span> <span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
             <span class="k">else</span> <span class="n">default_slope</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rd</span><span class="o">.</span><span class="n">rno</span><span class="p">])</span>
        <span class="n">slopes</span><span class="p">[</span><span class="n">slopes</span> <span class="o">&lt;</span> <span class="n">minimum_slope</span><span class="p">]</span> <span class="o">=</span> <span class="n">minimum_slope</span>
        <span class="n">slopes</span><span class="p">[</span><span class="n">slopes</span> <span class="o">&gt;</span> <span class="n">maximum_slope</span><span class="p">]</span> <span class="o">=</span> <span class="n">maximum_slope</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">[</span><span class="s1">&#39;slope&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">slopes</span></div>

<div class="viewcode-block" id="SFRData.from_package"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.from_package">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_package</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">sfrpackagefile</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">namefile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">sim_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_ws</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                     <span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">package_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">linework</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read SFR package file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sfrpackagefile : file path</span>
<span class="sd">            Modflow-2005 or MODFLOW6 SFR package</span>
<span class="sd">        grid : sfrmaker.grid instance</span>
<span class="sd">        linework : shapefile path or DataFrame</span>
<span class="sd">            Contains linestrings for each reach; must have</span>
<span class="sd">            segment and reach, or reach number (rno in MODFLOW 6)</span>
<span class="sd">            information.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sfrdata : sfrmaker.sfrdata instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># todo:  finish SFRData.from_package</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;SFRData.from_package not implemented yet.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">get_sfr_package_format</span><span class="p">(</span><span class="n">sfrpackagefile</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">package_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">package_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">sfrpackagefile</span><span class="p">)</span>
        <span class="c1"># load the model and SFR package</span>
        <span class="k">if</span> <span class="n">namefile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">model_ws</span><span class="p">,</span> <span class="n">namefile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">namefile</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">Modflow</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">namefile</span><span class="p">,</span> <span class="n">model_ws</span><span class="o">=</span><span class="n">model_ws</span><span class="p">,</span> <span class="n">load_only</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SFR&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">sim_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sim</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">mf6</span><span class="o">.</span><span class="n">MFSimulation</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">sim_name</span><span class="p">,</span> <span class="s1">&#39;mf6&#39;</span><span class="p">,</span> <span class="s1">&#39;mf6&#39;</span><span class="p">,</span> <span class="n">model_ws</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">version</span> <span class="o">!=</span> <span class="s1">&#39;mf6&#39;</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">Modflow</span><span class="p">(</span><span class="n">model_ws</span><span class="o">=</span><span class="n">model_ws</span><span class="p">)</span>
                <span class="n">sfr</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">ModflowSfr2</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">sfrpackagefile</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sim</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">mf6</span><span class="o">.</span><span class="n">MFSimulation</span><span class="p">(</span><span class="n">sim_ws</span><span class="o">=</span><span class="n">model_ws</span><span class="p">)</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwf</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">modelname</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
                                         <span class="n">model_nam_file</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.nam&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model_name</span><span class="p">))</span>
                <span class="n">sfr</span> <span class="o">=</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwfsfr</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">sfrpackagefile</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">version</span> <span class="o">!=</span> <span class="s1">&#39;mf6&#39;</span><span class="p">:</span>
            <span class="n">reach_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">sfr</span><span class="o">.</span><span class="n">reach_data</span><span class="p">)</span>
            <span class="n">perioddata_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">per</span><span class="p">,</span> <span class="n">spd</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">sfr</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">spd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">spd</span> <span class="o">=</span> <span class="n">spd</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">spd</span><span class="p">[</span><span class="s1">&#39;per&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">per</span>
                    <span class="n">perioddata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spd</span><span class="p">)</span>
            <span class="n">segment_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">perioddata_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">reach_data</span><span class="o">=</span><span class="n">reach_data</span><span class="p">,</span> <span class="n">segment_data</span><span class="o">=</span><span class="n">segment_data</span><span class="p">,</span>
                   <span class="n">model</span><span class="o">=</span><span class="n">m</span><span class="p">,</span>
                   <span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">)</span></div>

<div class="viewcode-block" id="SFRData.from_tables"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.from_tables">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_tables</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">reach_data</span><span class="p">,</span> <span class="n">segment_data</span><span class="p">,</span>
                    <span class="n">grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">isfr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">reach_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">reach_data</span><span class="p">)</span>
        <span class="n">segment_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">segment_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">reach_data</span><span class="o">=</span><span class="n">reach_data</span><span class="p">,</span> <span class="n">segment_data</span><span class="o">=</span><span class="n">segment_data</span><span class="p">,</span>
                   <span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span> <span class="n">isfr</span><span class="o">=</span><span class="n">isfr</span><span class="p">)</span></div>

<div class="viewcode-block" id="SFRData.from_yaml"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.from_yaml">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_yaml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config_file</span><span class="p">,</span> <span class="n">package_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">write_output</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create an SFRData instance from a yaml-format configuration file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        config_file : str or mapping</span>
<span class="sd">            Path to Sfrmaker configuration file in yaml format,</span>
<span class="sd">            or a dictionary-like mapping.</span>
<span class="sd">        output_path : str</span>
<span class="sd">            Where output files will be saved. Default is &#39;.&#39;</span>
<span class="sd">            (in default_config.yml).</span>
<span class="sd">        package_name : str</span>
<span class="sd">            Optional argument for naming the output SFR package; otherwise</span>
<span class="sd">            can be specified in configuration file.</span>
<span class="sd">        write_output : bool</span>
<span class="sd">            Whether or not to write output files, including package file,</span>
<span class="sd">            reach and segment data tables and shapefiles.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sfrdata : sfrmaker.SFRData instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># load the configuration file</span>
        <span class="n">wd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># change the cwd to the config file path</span>
            <span class="n">path</span><span class="p">,</span> <span class="n">config_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;.&#39;</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
                <span class="n">cfg</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">Loader</span><span class="p">)</span>
        <span class="c1"># or accept a mapping as input</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">config_file</span>

        <span class="c1"># read in the default configuration</span>
        <span class="n">defaults_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="s1">&#39;default_config.yml&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">defaults_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
            <span class="n">defaults</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">Loader</span><span class="p">)</span>

        <span class="c1"># add defaults to configuration</span>
        <span class="n">cfg</span> <span class="o">=</span> <span class="n">update</span><span class="p">(</span><span class="n">defaults</span><span class="p">,</span> <span class="n">cfg</span><span class="p">)</span>

        <span class="c1"># set the package_name and output paths</span>
        <span class="k">if</span> <span class="n">package_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">package_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
            <span class="n">package_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;package_name&#39;</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">package_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;package_name&#39;</span><span class="p">])</span>
            <span class="n">package_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;simulation&#39;</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
            <span class="n">package_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;simulation&#39;</span><span class="p">][</span><span class="s1">&#39;sim_name&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="s1">&#39;model&#39;</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
            <span class="n">package_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;namefile&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">output_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output_path</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;output_path&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">output_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>

        <span class="c1"># model grids from shapefiles or flopy grids are supported</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;modelgrid&#39;</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
            <span class="n">grid_cfg</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;modelgrid&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;shapefile&#39;</span> <span class="ow">in</span> <span class="n">grid_cfg</span><span class="p">:</span>
                <span class="n">grid_kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">grid_cfg</span><span class="p">,</span> <span class="n">sfrmaker</span><span class="o">.</span><span class="n">StructuredGrid</span><span class="o">.</span><span class="n">from_shapefile</span><span class="p">)</span>
                <span class="n">grid</span> <span class="o">=</span> <span class="n">sfrmaker</span><span class="o">.</span><span class="n">StructuredGrid</span><span class="o">.</span><span class="n">from_shapefile</span><span class="p">(</span><span class="o">**</span><span class="n">grid_kwargs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">flopy</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Specifying a modelgrid with xoffset, yoffset, etc. requires flopy.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># convert delr/delc to ndarrays</span>
                <span class="k">for</span> <span class="n">delrc</span><span class="p">,</span> <span class="n">ncells</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;delr&#39;</span><span class="p">:</span> <span class="s1">&#39;ncol&#39;</span><span class="p">,</span> <span class="s1">&#39;delc&#39;</span><span class="p">:</span> <span class="s1">&#39;nrow&#39;</span><span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">grid_cfg</span><span class="p">[</span><span class="n">delrc</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">ncells</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">grid_cfg</span><span class="p">:</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Scalar value for </span><span class="si">{}</span><span class="s2"> requires &quot;</span>
                                   <span class="s2">&quot;specification of </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delrc</span><span class="p">,</span> <span class="n">ncells</span><span class="p">))</span>
                            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                        <span class="n">grid_cfg</span><span class="p">[</span><span class="n">delrc</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">grid_cfg</span><span class="p">[</span><span class="n">delrc</span><span class="p">]]</span> <span class="o">*</span> <span class="n">grid_cfg</span><span class="p">[</span><span class="n">ncells</span><span class="p">])</span>
                <span class="n">grid_cfg</span><span class="p">[</span><span class="s1">&#39;xoff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid_cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xoffset&#39;</span><span class="p">,</span> <span class="n">grid_cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xoff&#39;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span>
                <span class="n">grid_cfg</span><span class="p">[</span><span class="s1">&#39;yoff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid_cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;yoffset&#39;</span><span class="p">,</span> <span class="n">grid_cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;yoff&#39;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span>
                <span class="n">grid_kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">grid_cfg</span><span class="p">,</span> <span class="n">flopy</span><span class="o">.</span><span class="n">discretization</span><span class="o">.</span><span class="n">StructuredGrid</span><span class="p">)</span>
                <span class="n">grid</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">discretization</span><span class="o">.</span><span class="n">StructuredGrid</span><span class="p">(</span><span class="o">**</span><span class="n">grid_kwargs</span><span class="p">)</span>

        <span class="c1"># create a Lines instance</span>
        <span class="n">no_lines_msg</span> <span class="o">=</span> <span class="s2">&quot;A flowlines: block must be specified in configuration file.&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;flowlines&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">no_lines_msg</span><span class="p">)</span>
        <span class="n">lines_config</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;flowlines&#39;</span><span class="p">]</span>
        <span class="c1"># custom hydrography option</span>
        <span class="k">if</span> <span class="s1">&#39;filename&#39;</span> <span class="ow">in</span> <span class="n">lines_config</span><span class="p">:</span>
            <span class="n">lines_config</span><span class="p">[</span><span class="s1">&#39;shapefile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines_config</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span>
            <span class="n">lines_kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">lines_config</span><span class="p">,</span> <span class="n">sfrmaker</span><span class="o">.</span><span class="n">Lines</span><span class="o">.</span><span class="n">from_shapefile</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">sfrmaker</span><span class="o">.</span><span class="n">Lines</span><span class="o">.</span><span class="n">from_shapefile</span><span class="p">(</span><span class="o">**</span><span class="n">lines_kwargs</span><span class="p">)</span>
        <span class="c1"># nhdplus option</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># renames to deal with case issues</span>
            <span class="n">renames</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nhdplus_paths&#39;</span><span class="p">:</span> <span class="s1">&#39;NHDPlus_paths&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;nhdflowlines&#39;</span><span class="p">:</span> <span class="s1">&#39;NHDFlowlines&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;plusflowlinevaa&#39;</span><span class="p">:</span> <span class="s1">&#39;PlusFlowlineVAA&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;plusflow&#39;</span><span class="p">:</span> <span class="s1">&#39;PlusFlow&#39;</span><span class="p">}</span>
            <span class="n">lines_config</span> <span class="o">=</span> <span class="p">{</span><span class="n">renames</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">lines_config</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">lines_kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">lines_config</span><span class="p">,</span> <span class="n">sfrmaker</span><span class="o">.</span><span class="n">Lines</span><span class="o">.</span><span class="n">from_nhdplus_v2</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">sfrmaker</span><span class="o">.</span><span class="n">Lines</span><span class="o">.</span><span class="n">from_nhdplus_v2</span><span class="p">(</span><span class="o">**</span><span class="n">lines_kwargs</span><span class="p">)</span>

        <span class="c1"># load a model if there is one</span>
        <span class="c1"># modflow 6</span>
        <span class="n">model_version</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;package_version&#39;</span><span class="p">,</span> <span class="s1">&#39;mf6&#39;</span><span class="p">)</span>
        <span class="n">no_flopy_msg</span> <span class="o">=</span> <span class="s2">&quot;Specifying a model requires flopy.&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;simulation&#39;</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">flopy</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">no_flopy_msg</span><span class="p">)</span>
            <span class="n">sim_kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;simulation&#39;</span><span class="p">],</span> <span class="n">flopy</span><span class="o">.</span><span class="n">mf6</span><span class="o">.</span><span class="n">MFSimulation</span><span class="p">)</span>
            <span class="n">sim</span> <span class="o">=</span> <span class="n">mf6</span><span class="o">.</span><span class="n">MFSimulation</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="o">**</span><span class="n">sim_kwargs</span><span class="p">)</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;modelname&#39;</span><span class="p">])</span>
            <span class="n">model_version</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">version</span>
            <span class="k">if</span> <span class="n">grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">grid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">modelgrid</span>
        <span class="c1"># modflow-2005</span>
        <span class="k">elif</span> <span class="s1">&#39;model&#39;</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">flopy</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">no_flopy_msg</span><span class="p">)</span>
            <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;f&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;namefile&#39;</span><span class="p">]</span>
            <span class="n">model_kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">],</span> <span class="n">flopy</span><span class="o">.</span><span class="n">modflow</span><span class="o">.</span><span class="n">Modflow</span><span class="o">.</span><span class="n">load</span><span class="p">)</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">modflow</span><span class="o">.</span><span class="n">Modflow</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="o">**</span><span class="n">model_kwargs</span><span class="p">)</span>
            <span class="n">model_version</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">version</span>
            <span class="k">if</span> <span class="n">grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">grid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">modelgrid</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># create an SFRData instance</span>
        <span class="n">to_sfr_kwargs</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">to_sfr_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;options&#39;</span><span class="p">,</span> <span class="p">{}))</span>
        <span class="n">to_sfr_kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">to_sfr_kwargs</span><span class="p">,</span> <span class="n">sfrmaker</span><span class="o">.</span><span class="n">Lines</span><span class="o">.</span><span class="n">to_sfr</span><span class="p">)</span>
        <span class="n">to_sfr_kwargs</span><span class="p">[</span><span class="s1">&#39;active_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;active_area&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">)</span>
        <span class="n">to_sfr_kwargs</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>
        <span class="n">to_sfr_kwargs</span><span class="p">[</span><span class="s1">&#39;grid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid</span>
        <span class="n">to_sfr_kwargs</span><span class="p">[</span><span class="s1">&#39;package_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">package_name</span>
        <span class="c1"># to_sfr() populates isfr from model if neither active_area or isfr are argued</span>
        <span class="n">sfrdata</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">to_sfr</span><span class="p">(</span><span class="o">**</span><span class="n">to_sfr_kwargs</span><span class="p">)</span>
        <span class="n">sfrdata</span><span class="o">.</span><span class="n">_tables_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">sfrdata</span><span class="o">.</span><span class="n">_tables_path</span><span class="p">)</span>
        <span class="n">sfrdata</span><span class="o">.</span><span class="n">_shapefiles_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">sfrdata</span><span class="o">.</span><span class="n">_shapefiles_path</span><span class="p">)</span>

        <span class="c1"># setup elevations</span>
        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;options&#39;</span><span class="p">,</span> <span class="n">cfg</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;set_streambed_top_elevations_from_dem&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;set_streambed_top_elevations_from_dem=True &quot;</span>
                         <span class="s2">&quot;requires a dem: block.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;dem&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
            <span class="n">elevation_units</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;dem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;elevation_units&#39;</span><span class="p">)</span>
            <span class="n">sfrdata</span><span class="o">.</span><span class="n">set_streambed_top_elevations_from_dem</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;dem&#39;</span><span class="p">][</span><span class="s1">&#39;filename&#39;</span><span class="p">],</span>
                                                          <span class="n">dem_z_units</span><span class="o">=</span><span class="n">elevation_units</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sfrdata</span><span class="o">.</span><span class="n">reach_data</span><span class="p">[</span><span class="s1">&#39;strtop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sfrdata</span><span class="o">.</span><span class="n">interpolate_to_reaches</span><span class="p">(</span><span class="s1">&#39;elevup&#39;</span><span class="p">,</span> <span class="s1">&#39;elevdn&#39;</span><span class="p">)</span>

        <span class="c1"># assign layers to the sfr reaches</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sfrdata</span><span class="o">.</span><span class="n">assign_layers</span><span class="p">(</span><span class="n">adjusted_botm_output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">)</span>

        <span class="c1"># option to convert reaches to the River Package</span>
        <span class="k">if</span> <span class="s1">&#39;to_riv&#39;</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
            <span class="n">rivdata</span> <span class="o">=</span> <span class="n">sfrdata</span><span class="o">.</span><span class="n">to_riv</span><span class="p">(</span><span class="n">line_ids</span><span class="o">=</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;to_riv&#39;</span><span class="p">],</span>
                                     <span class="n">drop_in_sfr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">sfrdata</span><span class="o">.</span><span class="n">setup_riv</span><span class="p">(</span><span class="n">rivdata</span><span class="p">)</span>
            <span class="n">rivdata</span><span class="o">.</span><span class="n">write_table</span><span class="p">()</span>
            <span class="n">rivdata</span><span class="o">.</span><span class="n">write_shapefiles</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;to_riv option: output table and shapefiles written, but&#39;</span>
                  <span class="s1">&#39;writing of RIV package not implemented yet. Use flopy to&#39;</span>
                  <span class="s1">&#39;write the RIV package.&#39;</span><span class="p">)</span>

        <span class="c1"># add inflows</span>
        <span class="k">if</span> <span class="s1">&#39;inflows&#39;</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
            <span class="n">inflows_input</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;inflows&#39;</span><span class="p">]</span>
            <span class="c1"># resample inflows to model stress periods</span>
            <span class="n">inflows_input</span><span class="p">[</span><span class="s1">&#39;id_column&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inflows_input</span><span class="p">[</span><span class="s1">&#39;line_id_column&#39;</span><span class="p">]</span>
            <span class="n">inflows_by_stress_period</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">inflows_input</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">])</span>

            <span class="c1"># check if all inflow sites are included in sfr network</span>
            <span class="n">missing_sites</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">inflows_by_stress_period</span><span class="p">[</span><span class="n">inflows_input</span><span class="p">[</span><span class="s1">&#39;id_column&#39;</span><span class="p">]])</span><span class="o">.</span> \
                <span class="n">difference</span><span class="p">(</span><span class="n">lines</span><span class="o">.</span><span class="n">_original_routing</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">missing_sites</span><span class="p">):</span>
                <span class="n">inflows_routing_input</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;inflows_routing&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inflows_routing_input</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">((</span><span class="s1">&#39;inflow sites </span><span class="si">{}</span><span class="s1"> are not within the model sfr network. &#39;</span>
                                    <span class="s1">&#39;Please supply an inflows_routing: block&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">missing_sites</span><span class="p">)))</span>
                <span class="n">routing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">inflows_routing_input</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">])</span>
                <span class="n">routing</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">routing</span><span class="p">[</span><span class="n">inflows_routing_input</span><span class="p">[</span><span class="s1">&#39;id_column&#39;</span><span class="p">]],</span>
                                   <span class="n">routing</span><span class="p">[</span><span class="n">inflows_routing_input</span><span class="p">[</span><span class="s1">&#39;routing_column&#39;</span><span class="p">]]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">routing</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">_original_routing</span>
            <span class="n">missing_sites</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">inflows_by_stress_period</span><span class="p">[</span><span class="n">inflows_input</span><span class="p">[</span><span class="s1">&#39;id_column&#39;</span><span class="p">]])</span><span class="o">.</span> \
                                <span class="n">difference</span><span class="p">(</span><span class="n">routing</span><span class="o">.</span><span class="n">keys</span><span class="p">())),</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">missing_sites</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">((</span><span class="s1">&#39;Inflow sites </span><span class="si">{}</span><span class="s1"> not found in </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">missing_sites</span><span class="p">,</span>
                                                                         <span class="n">inflows_routing_input</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">])))</span>

            <span class="c1"># add resampled inflows to SFR package</span>
            <span class="n">inflows_input</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inflows_by_stress_period</span>
            <span class="n">inflows_input</span><span class="p">[</span><span class="s1">&#39;flowline_routing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">routing</span>
            <span class="k">if</span> <span class="n">model_version</span> <span class="o">==</span> <span class="s1">&#39;mf6&#39;</span><span class="p">:</span>
                <span class="n">inflows_input</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;inflow&#39;</span>
                <span class="n">method</span> <span class="o">=</span> <span class="n">sfrdata</span><span class="o">.</span><span class="n">add_to_perioddata</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">method</span> <span class="o">=</span> <span class="n">sfrdata</span><span class="o">.</span><span class="n">add_to_segment_data</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">inflows_input</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">method</span><span class="p">)</span>
            <span class="n">method</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># add observations</span>
        <span class="k">if</span> <span class="s1">&#39;observations&#39;</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="p">:</span>
                <span class="k">pass</span> <span class="c1">#  raise KeyError(&#39;Setup of observations input results a model: block&#39;)</span>
            <span class="k">if</span> <span class="n">model_version</span> <span class="o">!=</span> <span class="s1">&#39;mf6&#39;</span><span class="p">:</span>
                <span class="n">sfrdata</span><span class="o">.</span><span class="n">gage_starting_unit_number</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;gag&#39;</span><span class="p">][</span><span class="s1">&#39;starting_unit_number&#39;</span><span class="p">]</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;filename&#39;</span> <span class="k">if</span> <span class="s1">&#39;filename&#39;</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;observations&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;filenames&#39;</span>
            <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;observations&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;observations&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;observations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">sfrdata</span><span class="o">.</span><span class="n">add_observations</span><span class="p">)</span>
            <span class="n">obsdata</span> <span class="o">=</span> <span class="n">sfrdata</span><span class="o">.</span><span class="n">add_observations</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">write_output</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">package_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">package_name</span> <span class="o">+</span> <span class="s1">&#39;.sfr&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">package_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_ws</span><span class="p">,</span> <span class="n">package_name</span> <span class="o">+</span> <span class="s1">&#39;.sfr&#39;</span><span class="p">)</span>
            <span class="n">sfrdata</span><span class="o">.</span><span class="n">write_package</span><span class="p">(</span><span class="n">package_file_path</span><span class="p">,</span>
                                  <span class="n">version</span><span class="o">=</span><span class="n">model_version</span><span class="p">)</span>
            <span class="n">sfrdata</span><span class="o">.</span><span class="n">write_tables</span><span class="p">()</span>
            <span class="n">sfrdata</span><span class="o">.</span><span class="n">write_shapefiles</span><span class="p">()</span>

        <span class="c1"># change the cwd back</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">wd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sfrdata</span></div>

<div class="viewcode-block" id="SFRData.to_riv"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.to_riv">[docs]</a>    <span class="k">def</span> <span class="nf">to_riv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rno</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">drop_in_sfr</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cast one or more reaches to a RivData instance,</span>
<span class="sd">        which can then be written as input to the MODFLOW RIV package.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        segments : sequence of ints</span>
<span class="sd">            Convert the listed segments, and all downstream segments,</span>
<span class="sd">            to the RIV package. If None, all segments are converted (default).</span>
<span class="sd">        rno : sequence of ints</span>
<span class="sd">            Convert the listed reach numbers (nro), and all downstream reaches,</span>
<span class="sd">            to the RIV package. If None, all reaches are converted (default).</span>
<span class="sd">        line_ids : sequence of ints</span>
<span class="sd">            Convert the segments corresponding to the line_ids </span>
<span class="sd">            (unique identifiers for LineString features in the source hydrography), </span>
<span class="sd">            and all downstream segments to the RIV package. If None, all reaches </span>
<span class="sd">            are converted (default).</span>
<span class="sd">        drop_in_sfr : bool</span>
<span class="sd">            Whether or not to remove the converted segments from the SFR package</span>
<span class="sd">            (default True)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        riv : SFRmaker.RivData instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get the downstream segments to be converted</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">segments</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rno</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">line_ids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#loc = slice(None, None)  # all reaches</span>
            <span class="c1"># if all reaches are being converted,</span>
            <span class="c1"># skip dropping the reaches from the sfr package</span>
            <span class="n">drop_in_sfr</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">segments</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">segments</span><span class="p">):</span>
                <span class="n">segments</span> <span class="o">=</span> <span class="p">[</span><span class="n">segments</span><span class="p">]</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">loc</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">iseg</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">line_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">line_ids</span><span class="p">):</span>
                <span class="n">line_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">line_ids</span><span class="p">]</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">loc</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">line_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">line_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rno</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">rno</span><span class="p">):</span>
                <span class="n">rno</span> <span class="o">=</span> <span class="p">[</span><span class="n">rno</span><span class="p">]</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">loc</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">rno</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">rno</span><span class="p">)</span>
        <span class="n">reaches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">loc</span><span class="p">,</span> <span class="s1">&#39;rno&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">to_riv_reaches</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">rno</span> <span class="ow">in</span> <span class="n">reaches</span><span class="p">:</span>
            <span class="c1"># skip reaches that have already been considered</span>
            <span class="k">if</span> <span class="n">rno</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">to_riv_reaches</span><span class="p">:</span>
                <span class="n">to_riv_reaches</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_paths</span><span class="p">[</span><span class="n">rno</span><span class="p">]))</span>

        <span class="c1"># subset the RIV reaches from reach_data;</span>
        <span class="c1"># populate RIV input</span>
        <span class="n">is_riv_reach</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">rno</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">to_riv_reaches</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">is_riv_reach</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># consolidate the reaches to 1 per cell</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">consolidate_reach_conductances</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keep_only_dominant</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># add in a column for the stress period</span>
        <span class="c1"># even though transfer of any specified stage changes</span>
        <span class="c1"># aren&#39;t implemented yet</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;per&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cond&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Cond_sum&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">depth1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="c1"># find period with most data</span>
            <span class="n">per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;per&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">nseg</span><span class="p">)</span>
            <span class="n">reach_depths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolate_to_reaches</span><span class="p">(</span><span class="s1">&#39;depth1&#39;</span><span class="p">,</span> <span class="s1">&#39;depth2&#39;</span><span class="p">,</span> <span class="n">per</span><span class="o">=</span><span class="n">per</span><span class="p">)</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;stage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;strtop&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">reach_depths</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;stage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;strtop&#39;</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rbot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;strtop&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;strthick&#39;</span><span class="p">]</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;per&#39;</span><span class="p">,</span> <span class="s1">&#39;rno&#39;</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;j&#39;</span><span class="p">,</span> <span class="s1">&#39;cond&#39;</span><span class="p">,</span> <span class="s1">&#39;stage&#39;</span><span class="p">,</span> <span class="s1">&#39;rbot&#39;</span><span class="p">,</span>
                <span class="s1">&#39;outreach&#39;</span><span class="p">,</span> <span class="s1">&#39;asum&#39;</span><span class="p">,</span> <span class="s1">&#39;line_id&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="n">riv_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># retain routing information between reaches;</span>
        <span class="c1"># but reset the numbering since the SFR number will be reset anways</span>
        <span class="c1"># (after the RIV reaches are removed from the SFR dataset)</span>
        <span class="n">new_rnos</span> <span class="o">=</span> <span class="n">renumber_segments</span><span class="p">(</span><span class="n">riv_data</span><span class="p">[</span><span class="s1">&#39;rno&#39;</span><span class="p">],</span> <span class="n">riv_data</span><span class="p">[</span><span class="s1">&#39;outreach&#39;</span><span class="p">])</span>
        <span class="n">riv_data</span><span class="p">[</span><span class="s1">&#39;rno&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_rnos</span><span class="p">[</span><span class="n">outreach</span><span class="p">]</span> <span class="k">for</span> <span class="n">outreach</span> <span class="ow">in</span> <span class="n">riv_data</span><span class="p">[</span><span class="s1">&#39;rno&#39;</span><span class="p">]]</span>
        <span class="n">riv_data</span><span class="p">[</span><span class="s1">&#39;outreach&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_rnos</span><span class="p">[</span><span class="n">outreach</span><span class="p">]</span> <span class="k">for</span> <span class="n">outreach</span> <span class="ow">in</span> <span class="n">riv_data</span><span class="p">[</span><span class="s1">&#39;outreach&#39;</span><span class="p">]]</span>

        <span class="n">riv</span> <span class="o">=</span> <span class="n">RivData</span><span class="p">(</span><span class="n">stress_period_data</span><span class="o">=</span><span class="n">riv_data</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span>
                      <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">model_length_units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_length_units</span><span class="p">,</span>
                      <span class="n">model_time_units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_time_units</span><span class="p">,</span>
                      <span class="n">package_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">,)</span>

        <span class="k">if</span> <span class="n">drop_in_sfr</span><span class="p">:</span>
            <span class="n">riv_reaches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">rno</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">to_riv_reaches</span><span class="p">)</span>
            <span class="n">riv_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">riv_reaches</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span><span class="p">]</span>
            <span class="n">is_riv_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">riv_nodes</span><span class="p">)</span>

            <span class="c1"># drop sfr from all model cells with a riv reach</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">is_riv_node</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># reset riv outreaches (that are no longer in SFR network)</span>
            <span class="c1"># to zero (exit for sfr network)</span>
            <span class="n">riv_outreaches</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">outreach</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">rno</span><span class="p">)</span>
            <span class="n">outreach_is_riv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">outreach</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">riv_outreaches</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">outreach_is_riv</span><span class="p">,</span> <span class="s1">&#39;outreach&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># drop segments that were completely converted to riv</span>
            <span class="n">riv_segments</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">nseg</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">iseg</span><span class="p">))</span>
            <span class="c1"># reset outseg numbers in reach_data to zero</span>
            <span class="n">outseg_is_riv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">outseg</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">riv_segments</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">outseg_is_riv</span><span class="p">,</span> <span class="s1">&#39;outseg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># drop these segments from segment_data</span>
            <span class="n">is_riv_segment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">nseg</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">riv_segments</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">is_riv_segment</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">outseg_is_riv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">outseg</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">riv_segments</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">outseg_is_riv</span><span class="p">,</span> <span class="s1">&#39;outseg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># reset the numbering to be consecutive</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reset_routing</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">riv</span></div>

<div class="viewcode-block" id="SFRData.run_diagnostics"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.run_diagnostics">[docs]</a>    <span class="k">def</span> <span class="nf">run_diagnostics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checkfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the Flopy SFR diagnostic suite.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        checkfile : str</span>
<span class="sd">            Path of file to write results to, by default, results</span>
<span class="sd">            are written to {}_SFR.chk, where {} is the</span>
<span class="sd">            SFRData.package_name attribute.</span>
<span class="sd">        kwargs : keyword arguments to flopy.modflow.ModflowSfr2.check()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">flopy</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Running Flopy v. </span><span class="si">{}</span><span class="s1"> diagnostics...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flopy</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_modflow_sfr2</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">checkfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">checkfile</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_SFR.chk&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ModflowSfr2</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">checkfile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">checkfile</span><span class="p">))</span></div>

<div class="viewcode-block" id="SFRData.write_package"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.write_package">[docs]</a>    <span class="k">def</span> <span class="nf">write_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;mf2005&#39;</span><span class="p">,</span> <span class="n">idomain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">run_diagnostics</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">write_observations_input</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">external_files_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gage_starting_unit_number</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write an SFR package input file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str, optional</span>
<span class="sd">            File name for SFR package. By default None, in which</span>
<span class="sd">            case the filename of the attached :py:class:`flopy.modflow.mfsfr2.ModflowSfr2` instance</span>
<span class="sd">            (``SFRData.modflow_sfr2.fn_path``) is used.</span>
<span class="sd">        version : str, optional, {&#39;mf2005&#39;, &#39;mfnwt&#39;, &#39;mf6&#39;}</span>
<span class="sd">            MODFLOW version for the SFR package, by default &#39;mf2005&#39;</span>
<span class="sd">        idomain : ndarray, optional</span>
<span class="sd">            3D numpy array designating active cells (idomain==1).</span>
<span class="sd">            SFR reaches in inactive cells will be written with &#39;none&#39; in the cellid field.</span>
<span class="sd">            by default None</span>
<span class="sd">        options : list, optional</span>
<span class="sd">            List of strings to write to the MODFLOW-6 SFR options block. For example::</span>

<span class="sd">                options=[&#39;save_flows&#39;,</span>
<span class="sd">                         &#39;BUDGET FILEOUT model.sfr.cbc&#39;,</span>
<span class="sd">                         &#39;STAGE FILEOUT model.sfr.stage.bin&#39;]</span>

<span class="sd">            * An appropriate unit_conversion is written by default.</span>
<span class="sd">            * Cell-by-cell budget and stage output files are also added by default if not specified.</span>
<span class="sd">            * If the :attr:`SFRData.observations` is populated and `write_observations_input=True`,</span>
<span class="sd">              the observation input file is also added.</span>
<span class="sd">            * All files added by default are placed in the same path as the SFR package file. If another</span>
<span class="sd">              location is desired, the file(s) need to be specified explicitly as strings in the options</span>
<span class="sd">              list.</span>

<span class="sd">            See MODFLOW-6 documentation for other options.</span>
<span class="sd">            By default None.</span>
<span class="sd">        run_diagnostics : bool, optional</span>
<span class="sd">            Option to run the :ref:`diagnostic checks &lt;Running diagnostics&gt;`.</span>
<span class="sd">            by default True</span>
<span class="sd">        write_observations_input : bool, optional</span>
<span class="sd">            Option to write input to the the MODFLOW-2005 gage package or MODFLOW-6 Observations Process.</span>
<span class="sd">            Requires attached observations, as added through the :py:meth:`SFRData.add_observations` method.</span>
<span class="sd">            by default True</span>
<span class="sd">        external_files_path : str, optional</span>
<span class="sd">            Path for writing an external file for packagedata, relative to the location of the SFR package file.</span>
<span class="sd">            If specified, an open/close statement referencing the file is written to the packagedata block.</span>
<span class="sd">            By default, None (packagedata table is written to the SFR package file)</span>
<span class="sd">        gage_starting_unit_number : int, optional</span>
<span class="sd">            Starting unit number for gage output files, </span>
<span class="sd">            by default None</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SFRmaker v. </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sfrmaker</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span>
        <span class="c1"># run the flopy SFR diagnostics</span>
        <span class="k">if</span> <span class="n">run_diagnostics</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_diagnostics</span><span class="p">()</span>

        <span class="c1"># recreate the flopy package object in case it changed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_modflow_sfr2</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">header_txt</span> <span class="o">=</span> <span class="s2">&quot;#SFR package created by SFRmaker v. </span><span class="si">{}</span><span class="s2">, &quot;</span> \
                     <span class="s2">&quot;via FloPy v. </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sfrmaker</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="n">flopy</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
        <span class="n">header_txt</span> <span class="o">+=</span> <span class="s2">&quot;#model length units: </span><span class="si">{}</span><span class="s2">, model time units: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_length_units</span><span class="p">,</span>
                                                                             <span class="bp">self</span><span class="o">.</span><span class="n">model_time_units</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modflow_sfr2</span><span class="o">.</span><span class="n">heading</span> <span class="o">=</span> <span class="n">header_txt</span>

        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modflow_sfr2</span><span class="o">.</span><span class="n">fn_path</span>

        <span class="k">if</span> <span class="n">gage_starting_unit_number</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gage_starting_unit_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gage_starting_unit_number</span>
        <span class="k">if</span> <span class="n">version</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;mf2005&#39;</span><span class="p">,</span> <span class="s1">&#39;mfnwt&#39;</span><span class="p">}:</span>

            <span class="k">if</span> <span class="n">write_observations_input</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">gage_package_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.gage&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_gage_package</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">gage_package_filename</span><span class="p">,</span>
                                        <span class="n">gage_starting_unit_number</span><span class="o">=</span><span class="n">gage_starting_unit_number</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">modflow_sfr2</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;wrote </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="s1">&#39;mf6&#39;</span><span class="p">:</span>

            <span class="c1"># instantiate Mf6SFR converter object with mf-nwt model/sfr package from flopy</span>
            <span class="kn">from</span> <span class="nn">.mf5to6</span> <span class="kn">import</span> <span class="n">Mf6SFR</span>
            <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># save budget and stage output by default</span>
                <span class="c1"># if options weren&#39;t specified, assume the output files</span>
                <span class="c1"># should be in the same location as the SFR package file</span>
                <span class="c1"># (do the same for obs below)</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">just_the_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;save_flows&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;BUDGET FILEOUT </span><span class="si">{}</span><span class="s1">.cbc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">just_the_filename</span><span class="p">),</span>
                           <span class="s1">&#39;STAGE FILEOUT </span><span class="si">{}</span><span class="s1">.stage.bin&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">just_the_filename</span><span class="p">),</span>
                           <span class="p">]</span>
            <span class="k">if</span> <span class="n">write_observations_input</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;obs6 filein&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="n">obs_input_filename</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.obs&#39;</span>
                    <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;OBS6 FILEIN </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">just_the_filename</span> <span class="o">+</span> <span class="s1">&#39;.obs&#39;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s1">&#39;obs6 filein&#39;</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="k">break</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">obs_input_filename</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_mf6_sfr_obsfile</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">obs_input_filename</span><span class="p">)</span>


            <span class="n">sfr6</span> <span class="o">=</span> <span class="n">Mf6SFR</span><span class="p">(</span><span class="n">SFRData</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">period_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">period_data</span><span class="p">,</span>
                          <span class="n">idomain</span><span class="o">=</span><span class="n">idomain</span><span class="p">,</span>
                          <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>

            <span class="c1"># write a MODFLOW 6 file</span>
            <span class="n">sfr6</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">external_files_path</span><span class="o">=</span><span class="n">external_files_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="SFRData.write_tables"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.write_tables">[docs]</a>    <span class="k">def</span> <span class="nf">write_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write :py:attr:`~SFRData.reach_data`, :py:attr:`~SFRData.segment_data`,</span>
<span class="sd">        and :py:attr:`~SFRData.period_data` (if populated) to csv files. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        basename : str, optional</span>
<span class="sd">            Base name for csv files, by default None, in which case</span>
<span class="sd">            :py:attr:`SFRData.package_name` is used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">basename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_path</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">output_path</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
            <span class="n">basename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_path</span><span class="p">,</span> <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">basename</span><span class="p">)</span>
            <span class="n">basename</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">basename</span><span class="p">)</span>
        <span class="n">reach_data_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">_sfr_reach_data.csv&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">basename</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">reach_data_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reach_data_file</span><span class="p">))</span>
        <span class="n">segment_data_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">_sfr_segment_data.csv&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">basename</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">segment_data_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">segment_data_file</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pd_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">_sfr_period_data.csv&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">basename</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">period_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">pd_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pd_file</span><span class="p">))</span></div>

<div class="viewcode-block" id="SFRData.write_gage_package"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.write_gage_package">[docs]</a>    <span class="k">def</span> <span class="nf">write_gage_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gage_package_unit</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
                           <span class="n">gage_starting_unit_number</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write observation input for the MODFLOW-2005 Gage Package.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str, optional</span>
<span class="sd">            Gage package file, by default None, in which case</span>
<span class="sd">            :py:attr:`SFRData.observations_file` is used.</span>
<span class="sd">        gage_package_unit : int, optional</span>
<span class="sd">            Unit number for Gage Package, by default 25</span>
<span class="sd">        gage_starting_unit_number : int, optional</span>
<span class="sd">            Starting unit number for gage output files, </span>
<span class="sd">            by default None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        gag : :py:class:`flopy.modflow.mfgage.ModflowGage` instance</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observations_file</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">observations_file</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">if</span> <span class="n">gage_starting_unit_number</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gage_starting_unit_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gage_starting_unit_number</span>
        <span class="n">gage_namfile_entries_file</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.namefile_entries&#39;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modflow_sfr2</span><span class="o">.</span><span class="n">parent</span>
            <span class="n">model</span><span class="o">.</span><span class="n">model_ws</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">write_gage_package</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observations</span><span class="p">,</span>
                                  <span class="n">gage_package_filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                                  <span class="n">gage_namfile_entries_file</span><span class="o">=</span><span class="n">gage_namfile_entries_file</span><span class="p">,</span>
                                  <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                                  <span class="n">gage_package_unit</span><span class="o">=</span><span class="n">gage_package_unit</span><span class="p">,</span>
                                  <span class="n">start_gage_unit</span><span class="o">=</span><span class="n">gage_starting_unit_number</span><span class="p">)</span></div>

<div class="viewcode-block" id="SFRData.write_mf6_sfr_obsfile"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.write_mf6_sfr_obsfile">[docs]</a>    <span class="k">def</span> <span class="nf">write_mf6_sfr_obsfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                              <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">sfr_output_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observations_file</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">observations_file</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">if</span> <span class="n">sfr_output_filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sfr_output_filename</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.output.csv&#39;</span>
        <span class="k">return</span> <span class="n">write_mf6_sfr_obsfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observations</span><span class="p">,</span>
                                     <span class="n">filename</span><span class="p">,</span>
                                     <span class="n">sfr_output_filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="SFRData.export_outlets"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.export_outlets">[docs]</a>    <span class="k">def</span> <span class="nf">export_outlets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Export shapefile of model cells with stream reaches.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_name</span> <span class="o">+</span> <span class="s1">&#39;_sfr_outlets.shp&#39;</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">outreach</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">export_reach_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span>
                          <span class="n">nodes</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span> <span class="n">geomtype</span><span class="o">=</span><span class="s1">&#39;point&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SFRData.export_routing"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.export_routing">[docs]</a>    <span class="k">def</span> <span class="nf">export_routing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Export linework shapefile showing all routing connections between SFR reaches.</span>
<span class="sd">        A length field containing the distance between connected reaches</span>
<span class="sd">        can be used to filter for the longest connections in a GIS.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_name</span> <span class="o">+</span> <span class="s1">&#39;_sfr_routing.shp&#39;</span>
        <span class="n">rd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="p">[[</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="s1">&#39;iseg&#39;</span><span class="p">,</span> <span class="s1">&#39;ireach&#39;</span><span class="p">,</span> <span class="s1">&#39;rno&#39;</span><span class="p">,</span> <span class="s1">&#39;outreach&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">rd</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;rno&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cellgeoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rd</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span>

        <span class="c1"># get the cell centers for each reach</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">cellgeoms</span><span class="p">]</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">cellgeoms</span><span class="p">]</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">rno</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)))</span>

        <span class="c1"># make lines of the reach connections between cell centers</span>
        <span class="n">geoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">rno</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">loc</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
            <span class="n">outreach</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">outreach</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">outreach</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">loc</span><span class="p">[</span><span class="n">outreach</span><span class="p">]</span>
            <span class="n">geoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LineString</span><span class="p">([(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]))</span>
            <span class="n">lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>
        <span class="n">rd</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lengths</span>
        <span class="n">rd</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geoms</span>
        <span class="n">df2shp</span><span class="p">(</span><span class="n">rd</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span></div>

<div class="viewcode-block" id="SFRData.export_transient_variable"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.export_transient_variable">[docs]</a>    <span class="k">def</span> <span class="nf">export_transient_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Export point shapefile showing locations with</span>
<span class="sd">        a given segment_data variable applied. For example, segments</span>
<span class="sd">        where streamflow is entering or leaving the upstream end of a stream segment (FLOW)</span>
<span class="sd">        or where RUNOFF is applied. Cell centroids of the first reach of segments with</span>
<span class="sd">        non-zero terms of varname are exported; values of varname are exported by</span>
<span class="sd">        stress period in the attribute fields (e.g. flow0, flow1, flow2... for FLOW</span>
<span class="sd">        in stress periods 0, 1, 2...</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        f : str, filename</span>
<span class="sd">        varname : str</span>
<span class="sd">            Variable in SFR Package dataset 6a (see SFR package documentation)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_name</span> <span class="o">+</span> <span class="s1">&#39;_sfr_</span><span class="si">{}</span><span class="s1">.shp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">varname</span><span class="p">)</span>

        <span class="c1"># if the data are in mf2005 format (by segment)</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;per&#39;</span><span class="p">,</span> <span class="s1">&#39;nseg&#39;</span><span class="p">])</span>

        <span class="c1"># pivot the segment data to segments x periods with values of varname</span>
        <span class="n">just_the_values</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;nseg&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;per&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">varname</span><span class="p">)</span>
        <span class="n">hasvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">just_the_values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">just_the_values</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">hasvalues</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No non-zero values of </span><span class="si">{}</span><span class="s1"> to export!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">varname</span><span class="p">))</span>
            <span class="k">return</span>
        <span class="c1"># rename the columns to indicate stress periods</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">varname</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="n">segs</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>

        <span class="c1"># join the pivoted values to reach location info</span>
        <span class="c1"># for now, follow mf2005 model and assume that variable applies to reach 1</span>
        <span class="n">isseg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">segs</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">iseg</span><span class="p">])</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="n">isseg</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">ireach</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">rd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">locations</span><span class="p">][[</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;j&#39;</span><span class="p">,</span> <span class="s1">&#39;iseg&#39;</span><span class="p">,</span> <span class="s1">&#39;ireach&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">rd</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;iseg&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">rd</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">iseg</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">rd</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="n">export_reach_data</span><span class="p">(</span><span class="n">rd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">geomtype</span><span class="o">=</span><span class="s1">&#39;point&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SFRData.export_observations"><a class="viewcode-back" href="../../api/sfrmaker.sfrdata.html#sfrmaker.sfrdata.SFRData.export_observations">[docs]</a>    <span class="k">def</span> <span class="nf">export_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">geomtype</span><span class="o">=</span><span class="s1">&#39;point&#39;</span><span class="p">):</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observations</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No observations to export!&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">rno</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">node</span><span class="p">))</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="n">rno</span><span class="p">]</span> <span class="k">for</span> <span class="n">rno</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rno&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observations_file</span> <span class="o">+</span> <span class="s1">&#39;.shp&#39;</span>
        <span class="n">export_reach_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">geomtype</span><span class="o">=</span><span class="n">geomtype</span><span class="p">)</span></div></div>

</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">
        Last updated on Nov 25, 2020.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>