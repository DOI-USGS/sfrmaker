<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>sfrmaker.observations &mdash; SFRmaker 0.11.1.post13.dev0+g2c4daff documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/documentation_options.js?v=f3c2e429"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            SFRmaker
          </a>
              <div class="version">
                0.11.1.post13.dev0+g2c4daff
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../philosophy.html"> Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html"> Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html"> Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../inputs.html"> Input Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html"> Using SFRmaker with a configuration file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/SFRmaker_demo.html"> Basic Usage in a scripting context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/preprocessing_demo.html"> Preprocessing NHDPlus version 2 data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/lines_from_NHDPlusHR_demo.html"> Using SFRmaker with NHDPlus High Resolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts.html"> Concepts and methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/sfrmaker_tools.html"> Stand-alone tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting.html"> Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html"> Code reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../config-summary.html"> Summary of configuration file options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-history.html"> Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html"> Contributing to SFRmaker</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Bibliography</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../references.html"> References cited</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SFRmaker</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">sfrmaker.observations</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for sfrmaker.observations</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Functions for handling observations of SFR package output.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span>
<span class="kn">from</span> <span class="nn">gisutils</span> <span class="kn">import</span> <span class="n">shp2df</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">flopy</span>
    <span class="n">fm</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">modflow</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">flopy</span> <span class="o">=</span> <span class="kc">False</span>
<span class="kn">from</span> <span class="nn">.gis</span> <span class="kn">import</span> <span class="n">get_shapefile_crs</span><span class="p">,</span> <span class="n">project</span>
<span class="kn">from</span> <span class="nn">.fileio</span> <span class="kn">import</span> <span class="n">read_tables</span>
<span class="kn">from</span> <span class="nn">.routing</span> <span class="kn">import</span> <span class="n">get_next_id_in_subset</span>


<div class="viewcode-block" id="add_observations">
<a class="viewcode-back" href="../../api/sfrmaker.observations.html#sfrmaker.observations.add_observations">[docs]</a>
<span class="k">def</span> <span class="nf">add_observations</span><span class="p">(</span><span class="n">sfrdata</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">flowline_routing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">obstype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sfrlines_shapefile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">rno_column_in_sfrlines</span><span class="o">=</span><span class="s1">&#39;rno&#39;</span><span class="p">,</span>
                     <span class="n">x_location_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">y_location_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">line_id_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">rno_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">obstype_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">obsname_column</span><span class="o">=</span><span class="s1">&#39;site_no&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add SFR observations to the observations DataFrame</span>
<span class="sd">    attribute of an sfrdata instance. Observations can</span>
<span class="sd">    by located on the SFR network by specifying reach number</span>
<span class="sd">    directly (rno_column), by x, y location (x_column_in_data and y_column in data),</span>
<span class="sd">    or by specifying the source hydrography lines that they are located on</span>
<span class="sd">    (line_id_column).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sfrdata : sfrmaker.SFRData instance</span>
<span class="sd">        SFRData instance with reach_data table attribute. To add observations from x, y coordinates,</span>
<span class="sd">        the reach_data table must have a geometry column with LineStrings representing each reach, or</span>
<span class="sd">        an sfrlines_shapefile is required. Reach numbers are assumed to be in an &#39;rno&#39; column.</span>
<span class="sd">    data : DataFrame, path to csv file, or list of DataFrames or file paths</span>
<span class="sd">        Table with information on the observation sites to be located. Must have</span>
<span class="sd">        either reach numbers (rno_column), line_ids (line_id_column),</span>
<span class="sd">        or x and y locations (x_column_in_data and y_column_in_data).</span>
<span class="sd">    obstype : str or list-like (optional)</span>
<span class="sd">        Type(s) of observation to record, for MODFLOW-6 (default &#39;downstream-flow&#39;; see</span>
<span class="sd">        MODFLOW-6 IO documentation for more details). Alternatively, observation</span>
<span class="sd">        types can be specified by row in data, using the obstype_column_in_data argument.</span>
<span class="sd">    x_location_column : str (optional)</span>
<span class="sd">        Column in data with site x-coordinates (in same CRS as SFR network).</span>
<span class="sd">    y_location_column : str (optional)</span>
<span class="sd">        Column in data with site y-coordinates (in same CRS as SFR network).</span>
<span class="sd">    sfrlines_shapefile : str (optional)</span>
<span class="sd">        Shapefile version of SFRdata.reach_data. Only needed if SFRdata.reach_data doesn&#39;t</span>
<span class="sd">        have LineString geometries for the reaches.</span>
<span class="sd">    rno_column_in_sfrlines : str (optional)</span>
<span class="sd">        Column in sfrlines with reach numbers for matching lines with reaches in sfrdata, or</span>
<span class="sd">        reach numbers assigned to observation sites. (default &#39;rno&#39;)</span>
<span class="sd">    line_id_column : str</span>
<span class="sd">        Column in data matching observation sites to line_ids in the source hydrography data.</span>
<span class="sd">    rno_column : str</span>
<span class="sd">        Column in data matching observation sites to reach numbers in the SFR network.</span>
<span class="sd">    flowline_routing : dict</span>
<span class="sd">        Optional dictionary of routing for source hydrography. Only needed</span>
<span class="sd">        if locating by line_id, and SFR network is a subset of the full source</span>
<span class="sd">        hydrography (i.e. some lines were dropped in the creation of the SFR packge,</span>
<span class="sd">        or if the sites are inflow points corresponding to lines outside of the model perimeter).</span>
<span class="sd">        In this case, observation points referenced to line_ids that are missing from the SFR</span>
<span class="sd">        network are placed at the first reach corresponding to the next downstream line_id</span>
<span class="sd">        that is represented in the SFR network.</span>
<span class="sd">    obstype_column : str (optional)</span>
<span class="sd">        Column in data with MODFLOW-6 observation types. For adding observations of different types.</span>
<span class="sd">        If obstype and obstype_column_in_data are none, the default of &#39;downstream-flow&#39; will be used.</span>
<span class="sd">    obsname_column : str</span>
<span class="sd">        Column in data with unique identifier (e.g. site number or name) for observation sites.</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Sites located by line_id (source hydrography) will be assigned to the last reach in the</span>
<span class="sd">    segment corresponding to the line_id. Locating by x, y or reach number is more accurate.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sfrd</span> <span class="o">=</span> <span class="n">sfrdata</span>
    <span class="n">reach_data</span> <span class="o">=</span> <span class="n">sfrdata</span><span class="o">.</span><span class="n">reach_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># allow input via a list of tables or single table</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">read_tables</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="n">obsname_column</span><span class="p">:</span> <span class="nb">object</span><span class="p">})</span><span class="c1">#, dtype={obsname_column: object})</span>
    <span class="c1"># need a special case if allowing obsname_column to also be identifier</span>
    <span class="k">if</span> <span class="n">obsname_column</span> <span class="o">==</span> <span class="n">rno_column</span><span class="p">:</span>
        <span class="n">obsname_column</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;obsnamecol_</span><span class="si">{</span><span class="n">obsname_column</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">data</span><span class="p">[</span><span class="n">obsname_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">rno_column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">obsname_column</span> <span class="o">==</span> <span class="n">line_id_column</span><span class="p">:</span>
        <span class="n">obsname_column</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;obsnamecol_</span><span class="si">{</span><span class="n">obsname_column</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">data</span><span class="p">[</span><span class="n">obsname_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">line_id_column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="n">obsname_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">obsname_column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="n">obsname_column</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">object</span>

    <span class="c1"># read reach geometries from a shapefile</span>
    <span class="k">if</span> <span class="n">sfrlines_shapefile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sfrlines</span> <span class="o">=</span> <span class="n">shp2df</span><span class="p">(</span><span class="n">sfrlines_shapefile</span><span class="p">)</span>
        <span class="n">geoms</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">sfrlines</span><span class="p">[</span><span class="n">rno_column_in_sfrlines</span><span class="p">],</span> <span class="n">sfrlines</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]))</span>
        <span class="n">reach_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">geoms</span><span class="p">[</span><span class="n">rno</span><span class="p">]</span> <span class="k">for</span> <span class="n">rno</span> <span class="ow">in</span> <span class="n">reach_data</span><span class="p">[</span><span class="s1">&#39;rno&#39;</span><span class="p">]]</span>

    <span class="c1"># if no reach number is provided</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Observation sites need reach number, (x,y) coordinates, or source hydrography IDs&quot;</span>
    <span class="k">if</span> <span class="n">rno_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>

        <span class="n">rno_column</span> <span class="o">=</span> <span class="s1">&#39;rno&#39;</span>

        <span class="c1"># get reach numbers by x, y location of sites</span>
        <span class="k">if</span> <span class="n">x_location_column</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">y_location_column</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">locs</span> <span class="o">=</span> <span class="n">locate_sites</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">reach_data</span><span class="p">,</span>
                                <span class="n">x_column_in_data</span><span class="o">=</span><span class="n">x_location_column</span><span class="p">,</span>
                                <span class="n">y_column_in_data</span><span class="o">=</span><span class="n">y_location_column</span><span class="p">,</span>
                                <span class="n">reach_id_col</span><span class="o">=</span><span class="s1">&#39;rno&#39;</span><span class="p">,</span>  <span class="c1"># reach number column in reach_data</span>
                                <span class="n">site_number_col</span><span class="o">=</span><span class="n">obsname_column</span>
                                <span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="n">rno_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="s1">&#39;rno&#39;</span><span class="p">]</span>

        <span class="c1"># get reach number from site locations in source hydrography (line_ids)</span>
        <span class="k">elif</span> <span class="n">line_id_column</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="c1"># map NHDPlus COMIDs to reach numbers</span>
            <span class="k">if</span> <span class="n">flowline_routing</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">line_id</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">reach_data</span><span class="o">.</span><span class="n">iseg</span><span class="p">,</span> <span class="n">reach_data</span><span class="o">.</span><span class="n">line_id</span><span class="p">))</span>
                <span class="n">sfr_routing</span> <span class="o">=</span> <span class="n">sfrdata</span><span class="o">.</span><span class="n">segment_routing</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                <span class="c1"># routing for source hydrography</span>
                <span class="n">flowline_routing</span> <span class="o">=</span> <span class="p">{</span><span class="n">line_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">line_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sfr_routing</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="c1"># get the last reach in each segment</span>
            <span class="n">r1</span> <span class="o">=</span> <span class="n">reach_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;iseg&#39;</span><span class="p">,</span> <span class="s1">&#39;ireach&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;iseg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
            <span class="n">line_id_rno_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">r1</span><span class="p">[</span><span class="s1">&#39;line_id&#39;</span><span class="p">],</span> <span class="n">r1</span><span class="p">[</span><span class="s1">&#39;rno&#39;</span><span class="p">]))</span>
            <span class="n">line_ids</span> <span class="o">=</span> <span class="n">get_next_id_in_subset</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">line_id</span><span class="p">,</span> <span class="n">flowline_routing</span><span class="p">,</span>
                                             <span class="n">data</span><span class="p">[</span><span class="n">line_id_column</span><span class="p">])</span>
            <span class="n">data</span><span class="p">[</span><span class="n">rno_column</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">line_id_rno_mapping</span><span class="p">[</span><span class="n">lid</span><span class="p">]</span> <span class="k">for</span> <span class="n">lid</span> <span class="ow">in</span> <span class="n">line_ids</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># create observations dataframe</span>
    <span class="n">obsdata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">sfrd</span><span class="o">.</span><span class="n">observations</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

    <span class="c1"># remove duplicate locations</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">rno_column</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">obsdata</span><span class="p">[</span><span class="s1">&#39;rno&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">rno_column</span><span class="p">]</span>

    <span class="c1"># segment and reach info</span>
    <span class="n">iseg_ireach</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">reach_data</span><span class="o">.</span><span class="n">rno</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="n">reach_data</span><span class="o">.</span><span class="n">iseg</span><span class="p">,</span> <span class="n">reach_data</span><span class="o">.</span><span class="n">ireach</span><span class="p">))))</span>
    <span class="n">obsdata</span><span class="p">[</span><span class="s1">&#39;iseg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">iseg_ireach</span><span class="p">[</span><span class="n">rno</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">rno</span> <span class="ow">in</span> <span class="n">obsdata</span><span class="o">.</span><span class="n">rno</span><span class="p">]</span>
    <span class="n">obsdata</span><span class="p">[</span><span class="s1">&#39;ireach&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">iseg_ireach</span><span class="p">[</span><span class="n">rno</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">rno</span> <span class="ow">in</span> <span class="n">obsdata</span><span class="o">.</span><span class="n">rno</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rno&#39;</span><span class="p">,</span> <span class="s1">&#39;iseg&#39;</span><span class="p">,</span> <span class="s1">&#39;ireach&#39;</span><span class="p">]:</span>
        <span class="n">obsdata</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">obsdata</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">obstype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obstype</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">obsdata</span><span class="p">[</span><span class="s1">&#39;obstype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obstype</span>
            <span class="n">obsdata</span><span class="p">[</span><span class="s1">&#39;obsname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">obsname_column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obstypes</span> <span class="o">=</span> <span class="n">obstype</span>
            <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">obstype</span> <span class="ow">in</span> <span class="n">obstypes</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">obsdata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;obstype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obstype</span>
                <span class="n">obsnme_suffix</span> <span class="o">=</span> <span class="n">obstype</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;obsname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">obsnme</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">obsnme_suffix</span><span class="si">}</span><span class="s2">&quot;</span> 
                                 <span class="k">for</span> <span class="n">obsnme</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">obsname_column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)]</span>
                <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="n">obsdata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">obstype_column</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">obsdata</span><span class="p">[</span><span class="s1">&#39;obstype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">obstype_column</span><span class="p">]</span>
        <span class="c1"># check if base observation names (with just site info) are unique</span>
        <span class="c1"># if not, formulate name based on type as well</span>
        <span class="n">site_names</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">obsname_column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">site_names</span><span class="p">))</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">obsname_suffixes</span> <span class="o">=</span> <span class="p">[</span><span class="n">obstype</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">obstype</span> <span class="ow">in</span> <span class="n">obsdata</span><span class="p">[</span><span class="s1">&#39;obstype&#39;</span><span class="p">]]</span>
            <span class="n">obsdata</span><span class="p">[</span><span class="s1">&#39;obsname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">obsnme</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">obsnme_suffix</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">obsnme</span><span class="p">,</span> <span class="n">obsnme_suffix</span> 
                                  <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">site_names</span><span class="p">,</span> <span class="n">obsname_suffixes</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obsdata</span><span class="p">[</span><span class="s1">&#39;obsname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">site_names</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obsdata</span><span class="p">[</span><span class="s1">&#39;obstype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;downstream-flow&#39;</span>
        <span class="n">obsdata</span><span class="p">[</span><span class="s1">&#39;obsname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">obsname_column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">obsdata</span></div>



<div class="viewcode-block" id="get_closest_reach">
<a class="viewcode-back" href="../../api/sfrmaker.observations.html#sfrmaker.observations.get_closest_reach">[docs]</a>
<span class="k">def</span> <span class="nf">get_closest_reach</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sfrlines</span><span class="p">,</span>
                      <span class="n">rno_column</span><span class="o">=</span><span class="s1">&#39;rno&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the SFR reach number closest to a point feature.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : scalar or list of scalars</span>
<span class="sd">        x-coordinate(s) of point feature(s)</span>
<span class="sd">    y : scalar or list of scalars</span>
<span class="sd">        y-coordinate(s) or point feature(s)</span>
<span class="sd">    sfrlines: dataframe</span>
<span class="sd">        DataFrame containing a geometry column with SFR line arcs,</span>
<span class="sd">        and a column rno_column with unique numbers for each reach.</span>
<span class="sd">    rno_column: str</span>
<span class="sd">        Column with unique number for each reach. default &quot;rno&quot;</span>
<span class="sd">    threshold : numeric</span>
<span class="sd">        Distance threshold (in CRS units). Only return reaches within</span>
<span class="sd">        this distance.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rno : int or list of ints</span>
<span class="sd">        Reach numbers for reaches closest to each location</span>
<span class="sd">        defined by x, y.</span>
<span class="sd">    distance: int or list of ints</span>
<span class="sd">        Distance from each site in x, y to the corresponding </span>
<span class="sd">        closest SFR reach.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scalar</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">scalar</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>

    <span class="n">geoms</span> <span class="o">=</span> <span class="n">sfrlines</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span>
    <span class="n">rno</span> <span class="o">=</span> <span class="n">sfrlines</span><span class="p">[</span><span class="n">rno_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="n">allX</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># all x coordinates in sfrlines</span>
    <span class="n">allY</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># all y coordinates in sfrlines</span>
    <span class="n">all_rno</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># reach number for each x, y point in sfrlines</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">geoms</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;Multi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">g</span><span class="p">:</span>
            <span class="n">gx</span><span class="p">,</span> <span class="n">gy</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">xy</span>
            <span class="n">allX</span> <span class="o">+=</span> <span class="n">gx</span>
            <span class="n">allY</span> <span class="o">+=</span> <span class="n">gy</span>
            <span class="n">all_rno</span> <span class="o">+=</span> <span class="p">[</span><span class="n">rno</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">gx</span><span class="p">)</span>
    <span class="n">allX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">allX</span><span class="p">)</span>
    <span class="n">allY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">allY</span><span class="p">)</span>
    <span class="n">all_rno</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_rno</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_rno</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">allX</span><span class="p">)</span>

    <span class="n">rno</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">allX</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
                            <span class="p">(</span><span class="n">allY</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
        <span class="n">rno</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_rno</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">distance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">distances</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">scalar</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rno</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">distance</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rno</span><span class="p">,</span> <span class="n">distance</span></div>



<div class="viewcode-block" id="locate_sites">
<a class="viewcode-back" href="../../api/sfrmaker.observations.html#sfrmaker.observations.locate_sites">[docs]</a>
<span class="k">def</span> <span class="nf">locate_sites</span><span class="p">(</span><span class="n">site_data</span><span class="p">,</span>
                 <span class="n">reach_data</span><span class="p">,</span>
                 <span class="n">active_area_shapefile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">x_column_in_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">y_column_in_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">reach_id_col</span><span class="o">=</span><span class="s1">&#39;rno&#39;</span><span class="p">,</span>
                 <span class="n">ireach_col</span><span class="o">=</span><span class="s1">&#39;ireach&#39;</span><span class="p">,</span>
                 <span class="n">iseg_col</span><span class="o">=</span><span class="s1">&#39;iseg&#39;</span><span class="p">,</span>
                 <span class="n">site_number_col</span><span class="o">=</span><span class="s1">&#39;site_no&#39;</span><span class="p">,</span>
                 <span class="n">keep_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">perimeter_buffer</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                 <span class="n">distance_threshold</span><span class="o">=</span><span class="mi">1000</span>
                 <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get SFR reach locations corresponding to x, y points</span>
<span class="sd">    (e.g. measurement site locations).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    site_data: (Geo)DataFrame or shapefile</span>
<span class="sd">        DataFrame or shapefile with point locations and attribute data for</span>
<span class="sd">        stream flow observation sites. Point locations can be specified</span>
<span class="sd">        in a DataFrame by either x_column_in_data and y_column_in_data, or</span>
<span class="sd">        a &#39;geometry&#39; column of shapely points. If shapefiles or GeoDataFrames are provided</span>
<span class="sd">        for both site_data and reach_data, they can be in any CRS, but both must have valid</span>
<span class="sd">        CRS references (.prj file or .crs attribute); otherwise site_data and</span>
<span class="sd">        reach_data are assumed to be in the same CRS.</span>
<span class="sd">    reach_data: (Geo)DataFrame or shapefile</span>
<span class="sd">        SFRData.reach_data DataFrame, or shapefile equivalent</span>
<span class="sd">        with line-arcs representing all segments and/or reaches.</span>
<span class="sd">        If shapefiles or GeoDataFrames are provided</span>
<span class="sd">        for both site_data and reach_data, they can be in any CRS, but both must have valid</span>
<span class="sd">        CRS references (.prj file or .crs attribute); otherwise site_data and</span>
<span class="sd">        reach_data are assumed to be in the same CRS.</span>
<span class="sd">    active_area_shapefile: ESRI shapefile or shapely polygon (optional)</span>
<span class="sd">        Shapefile or polygon, in same CRS as sfr_lines_shapefile,</span>
<span class="sd">        defining areal extent (perimeter) of SFR network.</span>
<span class="sd">    x_column_in_data : str (optional)</span>
<span class="sd">        Column in data with site x-coordinates (in same CRS as SFR network).</span>
<span class="sd">    y_column_in_data : str (optional)</span>
<span class="sd">        Column in data with site y-coordinates (in same CRS as SFR network).</span>
<span class="sd">    reach_id_col: str</span>
<span class="sd">        Column with 1-based unique number for each stream line-arc. default &quot;rno&quot;</span>
<span class="sd">    ireach_col: str</span>
<span class="sd">        Column with 1-based reach number within segment (i.e. in the modflow-2005 SFR data model),</span>
<span class="sd">        by default, &#39;ireach&#39;</span>
<span class="sd">    iseg_col: str</span>
<span class="sd">        Column with 1-based reach segment number (i.e. in the modflow-2005 SFR data model),</span>
<span class="sd">        by default, &#39;iseg&#39;</span>
<span class="sd">    site_number_col : str</span>
<span class="sd">        Name of column in sites_shapefile with number identifying each</span>
<span class="sd">        site to be located. default &quot;site_no&quot;</span>
<span class="sd">    keep_columns: list of strings</span>
<span class="sd">        List of columns in sites_shapefile to retain when</span>
<span class="sd">        writing output_csv_file and output_shape_file.</span>
<span class="sd">    perimeter_buffer : scalar</span>
<span class="sd">        Exclude flows within this distance of perimeter defined</span>
<span class="sd">        by active_area. For example, a value of 1000 would</span>
<span class="sd">        mean that sites must be at least 1 km inside of the active area perimeter to</span>
<span class="sd">        be included.</span>
<span class="sd">    distance_threshold : scalar</span>
<span class="sd">        Only consider sites within this distance of a stream line-arc.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    locs : DataFrame</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sfr_crs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">locs_crs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># read in sfr lines</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reach_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">sfrlines</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">reach_data</span><span class="p">)</span>
        <span class="n">sfr_crs</span> <span class="o">=</span> <span class="n">sfrlines</span><span class="o">.</span><span class="n">crs</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reach_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">sfrlines</span> <span class="o">=</span> <span class="n">reach_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">sfr_crs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sfrlines</span><span class="p">,</span> <span class="s1">&#39;crs&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Datatype for reach_data not understood: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reach_data</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">reach_id_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sfrlines</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">sfrlines</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sfrlines</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">sfrlines</span><span class="p">[</span><span class="n">reach_id_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sfrlines</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sfrlines</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">sfrlines</span><span class="p">[</span><span class="n">reach_id_col</span><span class="p">]</span>

    <span class="c1"># sites to locate</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">site_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">locs</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">site_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">site_data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">locs_crs</span> <span class="o">=</span> <span class="n">get_shapefile_crs</span><span class="p">(</span><span class="n">site_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">locs_crs</span> <span class="o">=</span> <span class="n">get_shapefile_crs</span><span class="p">(</span><span class="n">site_data</span><span class="p">)</span>
        <span class="n">locs</span><span class="p">[</span><span class="s1">&#39;site_no&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="n">site_number_col</span><span class="p">]</span>  <span class="c1"># str_ids(locs.site_no)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">site_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">locs</span> <span class="o">=</span> <span class="n">site_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">locs_crs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">locs</span><span class="p">,</span> <span class="s1">&#39;crs&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Datatype for site_data not understood: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site_data</span><span class="p">))</span>

    <span class="c1"># to_crs if crs are available</span>
    <span class="k">if</span> <span class="n">locs_crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sfr_crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">locs</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">project</span><span class="p">(</span><span class="n">locs</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">locs_crs</span><span class="p">,</span> <span class="n">sfr_crs</span><span class="p">)</span>

    <span class="c1"># get the x and y coordinates</span>
    <span class="k">if</span> <span class="n">x_column_in_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y_column_in_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="n">x_column_in_data</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="n">y_column_in_data</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">locs</span><span class="o">.</span><span class="n">geometry</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">locs</span><span class="o">.</span><span class="n">geometry</span><span class="p">]</span>

    <span class="n">ids</span><span class="p">,</span> <span class="n">distances</span> <span class="o">=</span> <span class="n">get_closest_reach</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sfrlines</span><span class="p">,</span>
                                       <span class="n">rno_column</span><span class="o">=</span><span class="n">reach_id_col</span><span class="p">)</span>
    <span class="n">reach_id_col</span> <span class="o">=</span> <span class="n">reach_id_col</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">locs</span><span class="p">[</span><span class="n">reach_id_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">ids</span>
    <span class="n">locs</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distances</span>
    <span class="k">if</span> <span class="n">iseg_col</span> <span class="ow">in</span> <span class="n">sfrlines</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">locs</span><span class="p">[</span><span class="n">iseg_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">sfrlines</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ids</span><span class="p">,</span> <span class="n">iseg_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="k">if</span> <span class="n">ireach_col</span> <span class="ow">in</span> <span class="n">sfrlines</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">locs</span><span class="p">[</span><span class="n">ireach_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">sfrlines</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ids</span><span class="p">,</span> <span class="n">ireach_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">locs</span> <span class="o">=</span> <span class="n">locs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">locs</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">distance_threshold</span><span class="p">]</span>

    <span class="c1"># cull observations at or outside of model perimeter</span>
    <span class="c1"># to only those along model perimeter</span>
    <span class="k">if</span> <span class="n">active_area_shapefile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">active_area</span> <span class="o">=</span> <span class="n">active_area_shapefile</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">active_area_shapefile</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">):</span>
            <span class="n">active_area</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">active_area_shapefile</span><span class="p">)</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">perimeter</span> <span class="o">=</span> <span class="n">active_area</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">perimeter_buffer</span><span class="p">)</span>
        <span class="n">perimeter_inside_buffer</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">perimeter</span><span class="o">.</span><span class="n">interiors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">keep</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rn</span> <span class="ow">in</span> <span class="n">locs</span><span class="p">[</span><span class="n">reach_id_col</span><span class="p">]:</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="n">sfrlines</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rn</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
            <span class="n">keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">within</span><span class="p">(</span><span class="n">perimeter_inside_buffer</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">keep</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">keep_columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">keep_columns</span> <span class="o">=</span> <span class="n">locs</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="n">reach_id_col</span><span class="p">,</span> <span class="n">iseg_col</span><span class="p">,</span> <span class="n">ireach_col</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keep_columns</span> <span class="ow">and</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">locs</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">keep_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="n">locs</span> <span class="o">=</span> <span class="n">locs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">keep</span><span class="p">,</span> <span class="n">keep_columns</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">locs</span></div>



<div class="viewcode-block" id="write_gage_package">
<a class="viewcode-back" href="../../api/sfrmaker.observations.html#sfrmaker.observations.write_gage_package">[docs]</a>
<span class="k">def</span> <span class="nf">write_gage_package</span><span class="p">(</span><span class="n">location_data</span><span class="p">,</span>
                       <span class="n">gage_package_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">gage_namfile_entries_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">sitename_col</span><span class="o">=</span><span class="s1">&#39;site_no&#39;</span><span class="p">,</span>
                       <span class="n">gage_package_unit</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
                       <span class="n">start_gage_unit</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    location_data : pandas.DataFrame</span>
<span class="sd">        Table of observation locations. Must have columns:</span>
<span class="sd">        &#39;iseg&#39;: segment number</span>
<span class="sd">        &#39;ireach&#39;: reach number</span>
<span class="sd">        sitename_col: specified by sitename_col argument (default &#39;site_no&#39;)</span>
<span class="sd">    gage_package_filename : str or pathlike</span>
<span class="sd">        Name for the gage package file, which will be written to the </span>
<span class="sd">        model workspace (``model.model_ws``) of the supplied flopy model instance. </span>
<span class="sd">        This must also be manually added to the MODFLOW .nam file, for example::</span>
<span class="sd">        </span>
<span class="sd">            GAGE          25 br_trans.gage</span>
<span class="sd">            </span>
<span class="sd">        Or, a new namefile can be written from the supplied flopy model instance.</span>
<span class="sd">    gage_namfile_entries_file : str or pathlike</span>
<span class="sd">        Namefile entries for the gage package output files will be written</span>
<span class="sd">        to this file. The contents of this file must then be manually</span>
<span class="sd">        copied and pasted into the MODFLOW .nam file.</span>
<span class="sd">        By default, None, in which case this file is named after gage_package_filename.</span>
<span class="sd">    model : flopy model instance</span>
<span class="sd">        Used for writing the gage package input file via flopy.</span>
<span class="sd">    sitename_col : str</span>
<span class="sd">        Unique name or number for each gage site.</span>
<span class="sd">        By default, &#39;site_no&#39;</span>
<span class="sd">    gage_package_unit : int</span>
<span class="sd">        MODFLOW unit number to assign to gage package.</span>
<span class="sd">        By default, 25</span>
<span class="sd">    start_gage_unit : int</span>
<span class="sd">        Modflow unit numbers for each gage package output file </span>
<span class="sd">        will be assigned sequentially starting at this number.</span>
<span class="sd">        By default, 200</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">gage_package_filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gage_package_filename</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.gage&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">modelname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gage_package_filename</span> <span class="o">=</span> <span class="s1">&#39;observations.gage&#39;</span>
    <span class="k">if</span> <span class="n">gage_namfile_entries_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gage_namfile_entries_file</span> <span class="o">=</span> <span class="n">gage_package_filename</span> <span class="o">+</span> <span class="s1">&#39;.namefile_entries&#39;</span>
    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gage_package_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_ws</span><span class="p">,</span>
                                             <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">gage_package_filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">gage_namfile_entries_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_ws</span><span class="p">,</span>
                                                 <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">gage_namfile_entries_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1"># read in stream gage observation locations from locate_flux_targets_in_SFR.py</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">location_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="n">sitename_col</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gagefile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">sitename</span><span class="si">}</span><span class="s1">.ggo&#39;</span> <span class="k">for</span> <span class="n">sitename</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">sitename_col</span><span class="p">]]</span>

    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">flopy</span><span class="p">:</span>
        <span class="c1"># create flopy gage package object</span>
        <span class="n">gage_data</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">ModflowGage</span><span class="o">.</span><span class="n">get_empty</span><span class="p">(</span><span class="n">ncells</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
        <span class="n">gage_data</span><span class="p">[</span><span class="s1">&#39;gageloc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;iseg&#39;</span><span class="p">]</span>
        <span class="n">gage_data</span><span class="p">[</span><span class="s1">&#39;gagerch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ireach&#39;</span><span class="p">]</span>
        <span class="n">gage_data</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start_gage_unit</span><span class="p">,</span> <span class="n">start_gage_unit</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
        <span class="n">gag</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">ModflowGage</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">numgage</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">gage_data</span><span class="p">),</span>
                             <span class="n">gage_data</span><span class="o">=</span><span class="n">gage_data</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">gagefile</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                             <span class="n">unitnumber</span><span class="o">=</span><span class="n">gage_package_unit</span>
                             <span class="p">)</span>
        <span class="n">gag</span><span class="o">.</span><span class="n">fn_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">gage_package_filename</span><span class="p">)</span>
        <span class="n">gag</span><span class="o">.</span><span class="n">write_file</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;writing a gage package without Flopy&#39;</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">gage_namfile_entries_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">gagefile</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;DATA  </span><span class="si">{:d}</span><span class="s1"> </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gage_data</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">gag</span></div>



<div class="viewcode-block" id="write_mf6_sfr_obsfile">
<a class="viewcode-back" href="../../api/sfrmaker.observations.html#sfrmaker.observations.write_mf6_sfr_obsfile">[docs]</a>
<span class="k">def</span> <span class="nf">write_mf6_sfr_obsfile</span><span class="p">(</span><span class="n">observation_locations</span><span class="p">,</span>
                          <span class="n">filename</span><span class="p">,</span>
                          <span class="n">sfr_output_filename</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                          <span class="n">print_input</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write MODFLOW-6 observation input for the SFR package.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    observation_locations : DataFrame or str (filepath to csv file)</span>
<span class="sd">        line_id : unique identifier for observation locations</span>
<span class="sd">    filename : str</span>
<span class="sd">        File path for MODFLOW-6 SFR observation input file</span>
<span class="sd">    sfr_output_filename : str</span>
<span class="sd">        File path that SFR observation output file</span>
<span class="sd">    digits : int</span>
<span class="sd">        the number of significant digits with which simulated values</span>
<span class="sd">        are written to the output file.</span>
<span class="sd">    print_input : bool</span>
<span class="sd">        keyword to indicate that the list of observation information</span>
<span class="sd">        will be written to the listing file immediately after it is read.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    writes filename</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">locs</span> <span class="o">=</span> <span class="n">observation_locations</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">observation_locations</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">observation_locations</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
        <span class="n">locs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">observation_locations</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;BEGIN OPTIONS</span><span class="se">\n</span><span class="s1">  DIGITS </span><span class="si">{:d}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">digits</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">print_input</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  PRINT_INPUT</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;END OPTIONS</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;BEGIN CONTINUOUS FILEOUT </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sfr_output_filename</span><span class="p">))</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# obsname  obstype  rno</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">locs</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  </span><span class="si">{}</span><span class="s1">  </span><span class="si">{}</span><span class="s1">  </span><span class="si">{:d}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">obsname</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">obstype</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">rno</span><span class="p">))</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;END CONTINUOUS</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;wrote </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">Last updated on Jan 15, 2024.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>